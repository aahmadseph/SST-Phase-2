{
    "id": "RC7f9f088314394fad9d5d830e8981965c",
    "type": "rule_components",
    "attributes": {
        "created_at": "2025-06-05T16:18:04.046Z",
        "delegate_descriptor_id": "core::actions::custom-code",
        "deleted_at": null,
        "dirty": false,
        "name": "SOT - CSF Events Tracking",
        "negate": false,
        "order": 1,
        "rule_order": 50,
        "timeout": 2000,
        "delay_next": true,
        "published": false,
        "published_at": null,
        "revision_number": 0,
        "updated_at": "2025-07-10T22:58:04.879Z",
        "created_by_email": "abhinav.alkuchi@sephora.com",
        "created_by_display_name": "abhinav alkuchi",
        "updated_by_email": "Aditya.Kumar@sephora.com",
        "updated_by_display_name": "Aditya Kumar",
        "settings": "{\"source\":\"(async function (event) {\\n\\n    function readCookie(name) {\\n        var nameEQ = name + \\\"=\\\";\\n        var ca = document.cookie.split(\\\";\\\");\\n        for (var i = 0; i \\u003c ca.length; i++) {\\n            var c = ca[i];\\n            while (c.charAt(0) === \\\" \\\") c = c.substring(1, c.length);\\n            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);\\n        }\\n        return null;\\n    }\\n\\n    function getValidLinkName(sotType) {\\n        if (\\n            typeof sotType === \\\"undefined\\\" ||\\n            sotType === null ||\\n            sotType === \\\"null\\\"\\n        ) {\\n            return false;\\n        }\\n        return true;\\n    }\\n\\n    function formatSotType(sotType) {\\n        return sotType \\u0026\\u0026 sotType.toLowerCase().replace(/([\\\\:\\\\-])/g, \\\" \\\");\\n    }\\n\\n    function safelyReadProperty(attributePath, objectInfo) {\\n        return Sephora.analytics.utils.safelyReadProperty(attributePath, objectInfo);\\n    }\\n\\n    function getEventDetail(attributePath) {\\n        const data = event.detail;\\n        return data ? safelyReadProperty(attributePath, data) : \\\"\\\";\\n    }\\n\\n    function getCsfLinkName() {\\n        let linkName = \\\"\\\";\\n        if (getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.linkName\\\")) {\\n            linkName = getEventDetail(\\\"data.linkName\\\");\\n        }\\n        return linkName;\\n    }\\n\\n    try {\\n        let csfLinkName = getCsfLinkName();\\n        let pageTitle = digitalData.page.attributes?.sephoraPageInfo?.pageName;\\n        let languageLocale = digitalData.page.attributes?.languageLocale?.toLowerCase()?.slice(-2);\\n        let biStatus = digitalData.user[0]?.segment.biStatus;\\n        let biPoints = digitalData.user[0]?.segment.biPoints;\\n        let profileId = digitalData.user[0]?.profile[0]?.profileInfo.profileID;\\n        let biAccountId = digitalData.user[0]?.segment.biAccountId;\\n        let platform = digitalData.page.attributes?.platform;\\n        let emailId = digitalData.user[0]?.profile[0]?.profileInfo.email;\\n        let referrerCode = digitalData.page.attributes?.campaigns?.marketingChannel;\\n        let signInStatus = digitalData.user[0]?.segment?.signInStatus;\\n        let timestamp = new Date().getTime();\\n        let ccpaConsentCookie = readCookie(\\\"ccpaConsentCookie\\\") === '1' ? 1 : 0;\\n\\n        // Link name (sotType) logic\\n        let linkName = \\\"\\\";\\n        let csfImpressionEvents = [\\n            \\\"csf.collection.tile.view\\\",\\n            \\\"csf.post.tile.view\\\",\\n            \\\"csf.product.tile.view\\\",\\n        ];\\n        let csfClickEvents = [\\n            \\\"csf.collection.tile.click\\\",\\n            \\\"csf.post.tile.click\\\",\\n            \\\"csf.product.tile.click\\\",\\n        ];\\n        if (csfImpressionEvents.includes(csfLinkName)) {\\n            linkName = 'store front viewable impression';\\n\\n        } else if (csfClickEvents.includes(csfLinkName)) {\\n            linkName = 'store front component click';\\n        }\\n\\n        // Component Type logic - sotV312\\n        let componentType = csfLinkName?.split('.')?.[1];\\n        let sotV312 = \\\"\\\";\\n        if (componentType === 'collection') {\\n            sotV312 = 'StoreFrontCollection';\\n        } else if (componentType === 'post') {\\n            sotV312 = 'StoreFrontPost';\\n        } else if (componentType === 'product') {\\n            sotV312 = 'StoreFrontProduct';\\n        }\\n\\n        let dataToSend = {\\n            campaign: {\\n                referrerCode: referrerCode,\\n            },\\n            sysInfo: {\\n                userLanguage: languageLocale,\\n                ipAddress: _satellite.getVar('[TMS] System Var - IP'),\\n            },\\n            pageInfo: {\\n                title: pageTitle,\\n            },\\n            session: {\\n                biId: biAccountId,\\n                biTier: biStatus,\\n                biPoints: biPoints,\\n                profileId: profileId,\\n                platform: platform,\\n                emailId: emailId,\\n                signInState: signInStatus,\\n                timestamp: timestamp,\\n            },\\n            sotVars: {\\n                sotSubType: 'store front view',\\n                sotV01: digitalData?.page?.category?.pageType,\\n                sotV13: ccpaConsentCookie,\\n                sotV15: getEventDetail(\\\"data.csfPayload.product_id\\\"),\\n                sotV278: _satellite.readCookie('referrer') || \\\"\\\",\\n                sotV312: sotV312,\\n                sotV405: getEventDetail(\\\"data.csfPayload.referral_owner_id\\\"),\\n                sotV406: getEventDetail(\\\"data.csfPayload.anchor_post_unique_key\\\"),\\n                sotV407: getEventDetail(\\\"data.csfPayload.anchor_collection_unique_key\\\"),\\n                sotV409: getEventDetail(\\\"data.traffic_source\\\") || getEventDetail(\\\"data.csfPayload.traffic_source\\\"),\\n            },\\n            eventTime: timestamp,\\n            eventId: _satellite.getVar(\\\"[UEID] :: Universal Event ID Fx\\\")(event) || _satellite.getVar(\\\"[TMS] :: Event Id\\\"),\\n        };\\n\\n        let isValidLinkName = getValidLinkName(linkName);\\n        if (isValidLinkName) {\\n            (window.sephoraOneTag_cmds = window.sephoraOneTag_cmds || []).push([\\n                \\\"trackEvent\\\",\\n                formatSotType(linkName),\\n                dataToSend,\\n                null,\\n                true,\\n            ]);\\n        }\\n    } catch (error) {\\n        console.log(\\\"Failed CSF Events Tracking Tag\\\", error);\\n    }\\n})(event);\",\"language\":\"javascript\"}"
    },
    "relationships": {
        "updated_with_extension_package": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c/updated_with_extension_package"
            },
            "data": {
                "id": "EP1fdd2a6ec2ae468fb1d2cac08df65f83",
                "type": "extension_packages"
            }
        },
        "updated_with_extension": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c/updated_with_extension"
            },
            "data": {
                "id": "EX35ce3802460d499b9f4c856d69a764b4",
                "type": "extensions"
            }
        },
        "extension": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c/extension"
            },
            "data": {
                "id": "EX881e591abc3d4b29b9681e2a4d337f74",
                "type": "extensions"
            }
        },
        "notes": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c/notes"
            }
        },
        "origin": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c/origin"
            },
            "data": {
                "id": "RC7f9f088314394fad9d5d830e8981965c",
                "type": "rule_components"
            }
        },
        "property": {
            "links": {
                "related": "https://reactor.adobe.io/properties/PR28bc45fcba184e70b64b2f0cf7fe70f8"
            },
            "data": {
                "id": "PR28bc45fcba184e70b64b2f0cf7fe70f8",
                "type": "properties"
            }
        },
        "rules": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c/rules"
            }
        }
    },
    "links": {
        "extension": "https://reactor.adobe.io/extensions/EX881e591abc3d4b29b9681e2a4d337f74",
        "origin": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c",
        "rules": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c/rules",
        "self": "https://reactor.adobe.io/rule_components/RC7f9f088314394fad9d5d830e8981965c"
    },
    "meta": {
        "latest_revision_number": 13
    }
}
