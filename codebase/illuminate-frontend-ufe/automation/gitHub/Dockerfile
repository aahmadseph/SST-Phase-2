ARG NODE_VERSION

FROM --platform=linux/amd64 node:${NODE_VERSION}

# Update local timezone to PST
RUN date
RUN ln -sf /usr/share/zoneinfo/America/Los_Angeles /etc/localtime
RUN echo "America/Los_Angeles" > /etc/timezone
RUN date

# Set debconf to Noninteractive to suppress next warning:
#     debconf: unable to initialize frontend: Dialog
#     debconf: (TERM is not set, so the dialog frontend is not usable.)
#     debconf: falling back to frontend: Readline
#     debconf: unable to initialize frontend: Readline
#     debconf: (This frontend requires a controlling tty.)
#     debconf: falling back to frontend: Teletype
#     dpkg-preconfigure: unable to re-open stdin:
ARG DEBIAN_FRONTEND=noninteractive

# Installation of general dependencies
RUN apt-get update -y && \
    apt-get upgrade -y && \
    apt-get install -y gnupg wget

# Installation of Google Chrome
RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add
RUN echo "deb http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list
RUN apt-get update -y && \
    apt-get install -y google-chrome-stable
# After Chrome installation /etc/apt/sources.list.d/google-chrome.list file will be created.
# As a result it leads to this warning:
#     W: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/google-chrome.list:3 and /etc/apt/sources.list.d/google.list:1
#     W: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/google-chrome.list:3 and /etc/apt/sources.list.d/google.list:1
#     W: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/google-chrome.list:3 and /etc/apt/sources.list.d/google.list:1
#     W: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/google-chrome.list:3 and /etc/apt/sources.list.d/google.list:1
# To avoid this warning, we delete the google.list file we created and keep the google-chrome.list generated by the installer.
RUN rm /etc/apt/sources.list.d/google.list

RUN node --version && \
    npm --version && \
    google-chrome-stable --version && \
    pwd && \
    ls -la && \
    pwd
# CMD tail -f /dev/null
