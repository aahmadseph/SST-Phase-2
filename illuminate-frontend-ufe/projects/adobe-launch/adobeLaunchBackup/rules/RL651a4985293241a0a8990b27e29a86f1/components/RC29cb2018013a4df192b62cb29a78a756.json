{
    "id": "RC29cb2018013a4df192b62cb29a78a756",
    "type": "rule_components",
    "attributes": {
        "created_at": "2022-11-16T18:57:10.974Z",
        "delegate_descriptor_id": "core::actions::custom-code",
        "deleted_at": null,
        "dirty": false,
        "name": "SOT- Link Tracking",
        "negate": false,
        "order": 1,
        "rule_order": 50,
        "timeout": 2000,
        "delay_next": true,
        "published": false,
        "published_at": null,
        "revision_number": 0,
        "updated_at": "2025-07-04T05:49:20.451Z",
        "created_by_email": "Ravinderreddy.Mandala@sephora.com",
        "created_by_display_name": "Ravinderreddy Mandala",
        "updated_by_email": "abhinav.alkuchi@sephora.com",
        "updated_by_display_name": "abhinav alkuchi",
        "settings": "{\"source\":\"(async function () {\\n  function readCookie(name) {\\n    var nameEQ = name + \\\"=\\\";\\n    var ca = document.cookie.split(\\\";\\\");\\n    for (var i = 0; i \\u003c ca.length; i++) {\\n      var c = ca[i];\\n      while (c.charAt(0) === \\\" \\\") c = c.substring(1, c.length);\\n      if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);\\n    }\\n    return null;\\n  }\\n  function getEventAttribute(attributePath) {\\n    var recentProp = Sephora.analytics.utils.getMostRecentEventProperty({\\n      pathToProperty: attributePath,\\n      fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT,\\n    });\\n    return recentProp;\\n  }\\n  function safelyReadProperty(attributePath, objectInfo) {\\n    return Sephora.analytics.utils.safelyReadProperty(\\n      attributePath,\\n      objectInfo\\n    );\\n  }\\n\\n  function getEventDetail(attributePath) {\\n    const data = event.detail;\\n    return data ? safelyReadProperty(attributePath, data) : \\\"\\\";\\n  }\\n\\n  function formatSotType(sotType) {\\n    return sotType \\u0026\\u0026 sotType.toLowerCase().replace(/([\\\\:\\\\-])/g, \\\" \\\");\\n  }\\n\\n  function getValidLinkName(sotType) {\\n    if (\\n      typeof sotType === \\\"undefined\\\" ||\\n      sotType === null ||\\n      sotType === \\\"null\\\"\\n    ) {\\n      return false;\\n    }\\n    return true;\\n  }\\n\\n  function getLinkName(getEventData) {\\n    if (getEventData?.linkName) {\\n      return getEventData.linkName;\\n    }\\n    if (getEventData?.actionInfo) {\\n      return getEventData.actionInfo;\\n    }\\n    return (\\n      getEventAttribute(\\\"eventInfo.attributes.linkName\\\") ||\\n      getEventAttribute(\\\"eventInfo.attributes.actionInfo\\\") ||\\n      \\\"\\\"\\n    );\\n  }\\n  \\n  //SMC-3928\\n  function processSponsoredEvent(initialLinkName, getEventDetail, getEventData) {\\n   function extractSponsoredProductData(sponsoredProducts) {\\n    if (!sponsoredProducts || !sponsoredProducts.isSponsoredProduct) {\\n      return { sotV191: null, sotV200: null };\\n    }\\n\\n    const sotV191 = sponsoredProducts.clickPayload ? sponsoredProducts.clickPayload : null;\\n    const sotV200 = sponsoredProducts.viewableImpressionPayload ? sponsoredProducts.viewableImpressionPayload : null;\\n    //const sotV398 = sponsoredProducts.onloadPayload ? sponsoredProducts.onloadPayload : null; \\n\\n    return { sotV191, sotV200 };\\n  }\\n\\n  let linkName = initialLinkName;\\n  let sponsoredProducts, sotV191 = null, sotV200 = null, sotV398 = null;\\n\\n  // Main PLA Events\\n  if (\\n    rmnEvents.includes(linkName) ||\\n    newSotTypeRmnEvents.includes(linkName)\\n  ) {\\n    linkName = rmnCarouselEvents.includes(linkName) ? \\\"pla sponsored carousel click\\\" : newSotTypeRmnEvents.includes(linkName) ? linkName : \\\"pla sponsored product click\\\";\\n\\n    sponsoredProducts = getEventDetail(\\\"data.sponsoredProductInformation\\\");\\n    ({ sotV191 } = extractSponsoredProductData(sponsoredProducts));\\n\\n  } else if (\\n    (rmnImpressionEvents.includes(linkName) ||\\n      newSotTypeRmnImpressionEvents.includes(linkName)) \\u0026\\u0026\\n    getEventData?.sponsoredProductInformation?.isSponsoredProduct\\n  ) {\\n    linkName = rmnCarouselImpressionEvents.includes(linkName) ? \\\"pla sponsored carousel viewable impression\\\" : newSotTypeRmnImpressionEvents.includes(linkName) ? linkName : \\\"pla sponsored product viewable impression\\\";\\n\\n    sponsoredProducts = getEventDetail(\\\"data.sponsoredProductInformation\\\");\\n    ({ sotV200 } = extractSponsoredProductData(sponsoredProducts));\\n\\n  } else if (\\n    rmnBannerEvents.includes(linkName) ||\\n    newSotTypeRmnBannerEvents.includes(linkName)\\n  ) {\\n    linkName = rmnBannerEvents.includes(linkName) ? linkName.replace(/_/g, \\\" \\\") : linkName;\\n\\n    sponsoredProducts = getEventDetail(\\\"data.sponsoredProductInformation\\\");\\n    const isImpression = linkName.includes(\\\"impression\\\") || linkName.includes(\\\"view\\\");\\n\\n    const extracted = extractSponsoredProductData(sponsoredProducts);\\n    sotV191 = isImpression ? null : extracted.sotV191;\\n    sotV200 = isImpression ? extracted.sotV200 : null;\\n    //sotV398 = extracted.sotV398;\\n\\n  } else if (homePageSponssoredBannerEvents.includes(linkName)) {\\n    // SA-398, SA-402\\n    sponsoredProducts = getEventDetail(\\\"data.sponsoredProductInformation\\\");\\n    const isImpression = linkName.includes(\\\"impression\\\");\\n\\n    const extracted = extractSponsoredProductData(sponsoredProducts);\\n    sotV191 = isImpression ? null : extracted.sotV191;\\n    sotV200 = isImpression ? extracted.sotV200 : null;\\n    //sotV398 = extracted.sotV398;\\n\\n  } else if (homePageSponssoredCarouselEvents.includes(linkName)) {\\n    // SA-403, SA-404\\n    sponsoredProducts = getEventDetail(\\\"data.sponsoredProductInformation\\\");\\n    const isImpression = linkName.includes(\\\"impression\\\");\\n\\n    const extracted = extractSponsoredProductData(sponsoredProducts);\\n    sotV191 = isImpression ? null : extracted.sotV191;\\n    sotV200 = isImpression ? extracted.sotV200 : null;\\n    //sotV398 = extracted.sotV398;\\n  } else if(onSiteOnloadEvents.includes(linkName)) {\\n    sponsoredProducts = getEventDetail(\\\"data.sponsoredProductInformation\\\");\\n    sotV398 = sponsoredProducts.onloadPayload ? sponsoredProducts.onloadPayload : null;\\n  }\\n\\n  return { linkName, sotV191, sotV200, sotV398 };\\n}\\n\\n  try {\\n    var getEventData = getEventDetail(\\\"data\\\");\\n    var linkName = getLinkName(getEventData);\\n    var ccpaConsentCookie = readCookie(\\\"ccpaConsentCookie\\\") === '1' ? 1 : 0;\\n    var biAccountId =\\n      safelyReadProperty(\\\"user[0].segment.biAccountId\\\", digitalData) || \\\"\\\";\\n    var biStatus =\\n      safelyReadProperty(\\\"user[0].segment.biStatus\\\", digitalData) || \\\"\\\";\\n    var biPoints =\\n      safelyReadProperty(\\\"user[0].segment.biPoints\\\", digitalData) || \\\"\\\";\\n    var timeZone =\\n      safelyReadProperty(\\\"page.attributes.date.timeZone\\\", digitalData) || \\\"\\\";\\n    var timeZoneName =\\n      safelyReadProperty(\\\"page.attributes.date.timeZoneName\\\", digitalData) ||\\n      \\\"\\\";\\n    var pageTitle =\\n      safelyReadProperty(\\n        \\\"page.attributes.sephoraPageInfo.pageName\\\",\\n        digitalData\\n      ) || \\\"\\\";\\n    var profileId = digitalData?.user?.[0]?.profile?.[0]?.profileInfo?.profileID || \\\"\\\";\\n    let pageType =\\n      safelyReadProperty(\\\"page.category.pageType\\\", digitalData) || \\\"\\\";\\n    var platform =\\n      safelyReadProperty(\\\"page.attributes.platform\\\", digitalData) || \\\"\\\";\\n    var emailId = digitalData?.user?.[0]?.profile?.[0]?.profileInfo?.email || \\\"\\\";\\n    var signInStatus = digitalData?.user?.[0]?.segment?.signInStatus || \\\"\\\";\\n    var languageLocale = safelyReadProperty(\\n      \\\"page.attributes.languageLocale\\\",\\n      digitalData\\n    )\\n      ?.toLowerCase()\\n      ?.slice(-2);\\n    var timestamp = new Date().getTime();\\n    // RMN sotTypes based on page\\n    let rmnSotTypePage =\\n      pageType === \\\"search\\\"\\n        ? \\\"search\\\"\\n        : pageType === \\\"product\\\"\\n        ? \\\"pdp\\\"\\n        : \\\"browse\\\";\\n    var fbpValue = readCookie(\\\"_fbp\\\");\\n    var fbcValue = readCookie(\\\"_fbc\\\");\\n    var sc_click_id = sessionStorage.getItem(\\\"sc_click_id\\\");\\n    let epikLS = JSON.parse(window.localStorage.getItem(\\\"_epik_ls\\\"));\\n    let epikLSValid =\\n      epikLS?.expires \\u0026\\u0026\\n      epikLS?.value \\u0026\\u0026\\n      !isNaN(new Date(epikLS.expires)) \\u0026\\u0026\\n      new Date(epikLS.expires) \\u003e= new Date();\\n    let epikId =\\n      new URL(window.location.href).searchParams.get(\\\"epik\\\") ||\\n      _satellite.cookie.get(\\\"_epik\\\") ||\\n      (epikLSValid \\u0026\\u0026 epikLS.value) ||\\n      \\\"\\\";\\n\\n    const utmParameters = JSON.parse(window.localStorage.getItem(\\\"utmParameters\\\"));\\n    const allowUtm = utmParameters?.expiration \\u003e= new Date().getTime() ? true : \\\"\\\";\\n    let sephSession = readCookie(\\\"SephSession\\\");\\n    const {\\n      utm_id,\\n      utm_source,\\n      utm_medium,\\n      utm_campaign,\\n      utm_source_platform,\\n      utm_term,\\n      utm_content,\\n      utm_creative_format,\\n      utm_marketing_tactic\\n    } = allowUtm ? utmParameters : {};\\n    const lowerCaseParams = new URLSearchParams(\\n      Array.from(new URLSearchParams(new URL(window.location.href).search), ([key, value]) =\\u003e [key.toLowerCase(), value])\\n    );\\n    const rdtCidURL = lowerCaseParams.get('rdt_cid');\\n    rdtCidURL \\u0026\\u0026 sessionStorage.setItem('rdt_cid', rdtCidURL);\\n    \\n    // DPS-1387, DPS-1629, DPS-1646\\n    var allowedLinkActionInfo = [\\n      \\\"un-love\\\",\\n      \\\"view items and checkout:shipped\\\",\\n      \\\"view items and checkout:bopis\\\",\\n      \\\"review:read more\\\",\\n      \\\"Question Answer Helpfulness\\\",\\n      \\\"questions\\u0026answers:sort selection\\\",\\n      \\\"Question Answer Sort\\\",\\n      \\\"questions and answers:show more\\\",\\n      \\\"proactive customer chat:displayed\\\",\\n      \\\"active customer chat:resume session\\\",\\n      \\\"reactive customer chat:start session\\\",\\n      \\\"reactive customer chat:end session\\\",\\n      \\\"order cancellation:request\\\",\\n      \\\"Enter Promo Code\\\",\\n      \\\"cmnty:joingroup\\\",\\n      \\\"cmnty:leavegroup\\\",\\n      \\\"cmnty:signup\\\",\\n      \\\"product:alt-image:zoom\\\",\\n      \\\"happening:use my location\\\",\\n      \\\"happening:enter my location\\\",\\n      \\\"creditcard:submit application\\\",\\n      \\\"order cancellation:success\\\",\\n      \\\"order cancellation:decline\\\",\\n      \\\"address verification:use recommended address:drop-down\\\",\\n      \\\"address verification:use recommended address\\\",\\n      \\\"address verification:use entered address\\\",\\n      \\\"cmnty:gallery:product-tagged\\\",\\n      \\\"cmnty:love:conversation\\\",\\n      \\\"remove from basket\\\",\\n      \\\"reviews:ratings and reviews-filter\\\",\\n      \\\"reviews:ratings and reviews:search\\\",\\n      \\\"checkout:payment:klarna\\\",\\n      \\\"Review Helpfulness\\\",\\n      \\\"video popup\\\",\\n      \\\"Video Progress\\\",\\n      \\\"Samples Selection Completed\\\",\\n      \\\"Custom Set Add To Set\\\",\\n      \\\"Custom Set Remove From Set\\\",\\n      \\\"Custom Set Items View More\\\",\\n      \\\"checkout:payment:continue with klarna\\\",\\n      \\\"alternate pickup person:submit\\\",\\n      \\\"alternate pickup person:removed\\\",\\n      \\\"order confirmation:continue shopping\\\",\\n      \\\"page view\\\",\\n      \\\"carousel_product_click\\\",\\n    ];\\n\\n    var sduEvents = [\\n      \\\"same-day unlimited edit payment saved\\\",\\n      \\\"same-day unlimited edit payment close\\\",\\n      \\\"same-day unlimited add payment close\\\",\\n      \\\"same-day unlimited add payment saved\\\",\\n      \\\"same-day unlimited remove payment\\\",\\n      \\\"same day unlimited zip code unavailable\\\",\\n      \\\"same-day unlimited update payment close\\\",\\n      \\\"same-day unlimited update payment saved\\\",\\n    ];\\n\\n    var set9Events = [\\n      \\\"user profile:my account:email:edit\\\",\\n      \\\"user profile:my account:name:edit\\\",\\n      \\\"user profile:my account:password:edit\\\",\\n      \\\"happening at sephora:appointment type-filter\\\",\\n      \\\"profile:bi-traits:private\\\",\\n      \\\"cmnty:my profile:edit\\\",\\n      \\\"product:alt-image:scroll:next\\\",\\n      \\\"product:alt-image:swatch:size\\\",\\n      \\\"Shop All From This Brand\\\",\\n      \\\"Write A Review\\\",\\n    ];\\n\\n    //SA-1406, SA-1407\\n    var set14OnwardsEvents = [\\n      // Set 14 events\\n      \\\"proactive customer chat:start session\\\",\\n      \\\"proactive customer chat:end session\\\",\\n      \\\"customer chat:unavailable\\\",\\n      \\\"Chat Page View\\\",\\n      // Set 15 events\\n      \\\"submit this answer\\\",\\n      \\\"submit a question\\\",\\n      \\\"See All Reviews\\\",\\n      \\\"user profile my account name update\\\",\\n      \\\"user profile my account password update\\\",\\n      // Set 17 events\\n      \\\"product fulfilment option selected\\\",\\n      \\\"bopis store selected\\\",\\n      // Set 23 events\\n      \\\"checkout:payment:afterpay\\\",\\n      \\\"checkout:payment:continue with afterpay\\\",\\n      // Set 24 events\\n      \\\"carousel product click\\\",\\n      \\\"product edit quantity\\\",\\n      \\\"checkout payment paypal click\\\",\\n      \\\"gift a service click\\\",\\n      \\\"here for curbside click\\\",\\n      \\\"creditcard manage my card\\\",\\n      \\\"apply creditcard reward\\\",\\n      \\\"share love list\\\",\\n      \\\"see order details and get sms updates click\\\",\\n      \\\"chiclets clear all\\\",\\n      \\\"chicklet items tapped\\\",\\n      \\\"beautyboard flagged\\\",\\n      \\\"beautyboard deletephoto\\\",\\n      \\\"forgot password email sent\\\",\\n      \\\"forgot password email resent\\\",\\n      \\\"auto replenish load more\\\",\\n      \\\"ugc photo change\\\",\\n      \\\"ugc scroll more navigation\\\",\\n      \\\"ugc image component click\\\",\\n      \\\"ugc product swipe\\\",\\n      \\\"product alt image swatch size\\\",\\n    ];\\n\\n    var rmnEvents = [\\n      \\\"pla_sponsored_product_click\\\",\\n      \\\"pla sponsored product click\\\",\\n      \\\"pla_sponsored_carousel_click\\\",\\n    ];\\n    var rmnImpressionEvents = [\\n      \\\"pla_sponsored_product_viewable_impression\\\",\\n      \\\"pla sponsored product viewable impression\\\",\\n      \\\"pla_sponsored_carousel_viewable_impression\\\",\\n      \\\"pla sponsored carousel viewable impression\\\",\\n    ];\\n    var rmnBannerEvents = [\\n      \\\"pla_sponsored_banner_click\\\",\\n      \\\"pla sponsored banner click\\\",\\n      \\\"pla_sponsored_banner_viewable_impression\\\",\\n      \\\"pla sponsored banner viewable impression\\\",\\n    ];\\n\\n    var newSotTypeRmnEvents = [\\n      `rmn.onsite.${rmnSotTypePage}.pla.in_grid.click`,\\n      `rmn.onsite.${rmnSotTypePage}.pla.carousel.click`,\\n    ];\\n\\n    var newSotTypeRmnImpressionEvents = [\\n      `rmn.onsite.${rmnSotTypePage}.pla.in_grid.impression`,\\n      `rmn.onsite.${rmnSotTypePage}.pla.in_grid.view`,\\n      `rmn.onsite.${rmnSotTypePage}.pla.carousel.view`,\\n    ];\\n\\n    var newSotTypeRmnBannerEvents = [\\n      `rmn.onsite.${rmnSotTypePage}.banner.leaderboard.impression`,\\n      `rmn.onsite.${rmnSotTypePage}.banner.leaderboard.view`,\\n      `rmn.onsite.${rmnSotTypePage}.banner.leaderboard.click`,\\n      `rmn.onsite.${rmnSotTypePage}.banner.siderail.impression`,\\n      `rmn.onsite.${rmnSotTypePage}.banner.siderail.view`,\\n      `rmn.onsite.${rmnSotTypePage}.banner.siderail.click`,\\n      `rmn.onsite.${rmnSotTypePage}.banner.mid_page.click`,\\n      `rmn.onsite.${rmnSotTypePage}.banner.mid_page.view`,\\n    ];\\n    \\n    var onSiteOnloadEvents = [\\n      `rmn.onsite.onload`\\n    ];\\n\\n    //SA-650, SA-637, SA-638, SA-643, SA-1326, SA-1473\\n    var autoReplenishEvents = [\\n      \\\"auto replenish manage subscription close\\\",\\n      \\\"auto replenish unsubscribe subscription confirmation\\\",\\n      \\\"auto replenish pause subscription close\\\",\\n      \\\"auto replenish get it sooner subscription close\\\",\\n      \\\"auto replenish get it sooner subscription confirmation\\\",\\n      \\\"auto replenish resume subscription close\\\",\\n      \\\"auto replenish delivery frequency confirmed\\\",\\n      \\\"auto replenish pause subscription confirmation\\\",\\n      \\\"auto replenish delivery frequency close\\\",\\n      \\\"auto replenish unsubscribe subscription close\\\",\\n      \\\"auto replenish skip subscription close\\\",\\n      \\\"auto replenish resume subscription confirmation\\\",\\n      \\\"auto replenish update payment saved\\\",\\n      \\\"auto replenish update payment close\\\",\\n      \\\"auto replenish add payment close\\\",\\n      \\\"auto replenish edit payment saved\\\",\\n      \\\"auto replenish add payment saved\\\",\\n      \\\"auto replenish edit payment close\\\",\\n      \\\"auto replenish remove payment\\\",\\n      \\\"auto replenish skip subscription confirmation\\\",\\n      \\\"auto replenish skip subscription unavailable\\\",\\n    ];\\n\\n    var rmnCarouselEvents = [\\n      \\\"pla_sponsored_carousel_click\\\",\\n      \\\"pla sponsored carousel click\\\",\\n    ];\\n    var rmnCarouselImpressionEvents = [\\n      \\\"pla_sponsored_carousel_viewable_impression\\\",\\n      \\\"pla sponsored carousel viewable impression\\\",\\n    ];\\n    var homePageSponssoredBannerEvents = [\\n      \\\"hp sponsored banner viewable impression\\\",\\n      \\\"hp sponsored banner click\\\",\\n    ];\\n    var homePageSponssoredCarouselEvents = [\\n      \\\"hp sponsored carousel viewable impression\\\",\\n      \\\"hp sponsored carousel click\\\",\\n    ];\\n    let medalliaEvents = [\\n      \\\"medallia feedback let us know click\\\",\\n      \\\"medallia form displayed\\\",\\n      \\\"medallia form submitted\\\",\\n      \\\"medallia form dismissed\\\",\\n    ];\\n    //SA-762, SA-763\\n    let bbqSignIn = [\\\"BBQ promo sign in\\\", \\\"BBQ promo join BI\\\"];\\n    //SA-829, SA-830\\n    let placeOrderEvents = [\\\"place order\\\", \\\"standard place order\\\"];\\n    //SA-1025, SA-1022,SA-1023, SA-1024\\n    let happeningAtSephoraEvents = [\\n      \\\"happening complete booking\\\",\\n      \\\"happening reserved item click\\\",\\n      \\\"happening cancel booking\\\",\\n      \\\"happening activity item tap\\\",\\n    ];\\n\\n    //SA-1260, SA-1361, SA-1362\\n    let beautyPreferencesEvents = [\\n      \\\"mysephora beauty preferences skip question\\\",\\n      \\\"mysephora bi signup skip spoke\\\",\\n    ];\\n    //SA-1261\\n    let beautyPreferencesSaveEvents = [\\n      \\\"beauty preference save\\\",\\n      \\\"beauty preference save and continue\\\",\\n    ];\\n    //SA-1262, SA-1266, SA-1267\\n    let viewBasketAndCheckoutEvent = [\\n      \\\"view basket and checkout\\\",\\n      \\\"checkout payment standard\\\",\\n      \\\"continue to checkout\\\",\\n    ];\\n    //SA-1360\\n    let addAllToBasket = [\\\"frequently bought together add all to basket\\\"];\\n    //SA-1404\\n    let productFinderQuiz = [\\\"product finder quiz question\\\"];\\n    //SA-1474\\n    let cardDetails = [\\\"credit card see details\\\"];\\n\\n    allowedLinkActionInfo = allowedLinkActionInfo.concat(\\n      set9Events,\\n      rmnEvents,\\n      rmnBannerEvents,\\n      newSotTypeRmnEvents,\\n      newSotTypeRmnImpressionEvents,\\n      newSotTypeRmnBannerEvents,\\n      onSiteOnloadEvents,\\n      set14OnwardsEvents,\\n      autoReplenishEvents,\\n      homePageSponssoredBannerEvents,\\n      homePageSponssoredCarouselEvents,\\n      sduEvents,\\n      medalliaEvents,\\n      bbqSignIn,\\n      placeOrderEvents,\\n      happeningAtSephoraEvents,\\n      beautyPreferencesEvents,\\n      beautyPreferencesSaveEvents,\\n      viewBasketAndCheckoutEvent,\\n      addAllToBasket,\\n      productFinderQuiz,\\n      cardDetails,\\n      [\\n        \\\"pla sponsored product viewable impression\\\",\\n        \\\"pla sponsored carousel viewable impression\\\",\\n      ],\\n      [\\\"pla sponsored carousel click\\\"],\\n      [\\\"bestseller carousel product click\\\"]\\n    );\\n    var isBasketSwitch = linkName.indexOf(\\\"change method\\\") != -1;\\n    var url_string = window.location.href;\\n    var url = new URL(url_string);\\n    var productId = url.searchParams.get(\\\"productId\\\");\\n    \\n    //SMC-3928\\n    if(Sephora.configurationSettings.smnBrowseCombinedCallEnabled) {\\n      var {linkName: updatedLinkName, sotV191, sotV200, sotV398 } = processSponsoredEvent(linkName, getEventDetail, getEventData);\\n      linkName = updatedLinkName || linkName;\\n    } else {\\n      if (\\n      rmnEvents.indexOf(linkName) \\u003e -1 ||\\n      newSotTypeRmnEvents.indexOf(linkName) \\u003e -1\\n    ) {\\n      if (rmnCarouselEvents.indexOf(linkName) \\u003e -1) {\\n        linkName = \\\"pla sponsored carousel click\\\";\\n      } else {\\n        linkName =\\n          newSotTypeRmnEvents.indexOf(linkName) \\u003e -1\\n            ? linkName\\n            : \\\"pla sponsored product click\\\";\\n      }\\n      var sponsoredProducts = getEventDetail(\\n        \\\"data.sponsoredProductInformation\\\"\\n      );\\n      if (sponsoredProducts \\u0026\\u0026 sponsoredProducts.isSponsoredProduct) {\\n        var sotV191;\\n        if (\\n          !sponsoredProducts.clickTrackerId \\u0026\\u0026\\n          !sponsoredProducts.clickPayload\\n        ) {\\n          sotV191 = null;\\n        } else {\\n          sotV191 =\\n            sponsoredProducts.clickTrackerId +\\n            \\\";\\\" +\\n            sponsoredProducts.clickPayload;\\n        }\\n      }\\n    } else if (\\n      (rmnImpressionEvents.indexOf(linkName) \\u003e -1 ||\\n        newSotTypeRmnImpressionEvents.indexOf(linkName) \\u003e -1) \\u0026\\u0026\\n      getEventData?.sponsoredProductInformation?.isSponsoredProduct\\n    ) {\\n      if (rmnCarouselImpressionEvents.indexOf(linkName) \\u003e -1) {\\n        linkName = \\\"pla sponsored carousel viewable impression\\\";\\n      } else {\\n        linkName =\\n          newSotTypeRmnImpressionEvents.indexOf(linkName) \\u003e -1\\n            ? linkName\\n            : \\\"pla sponsored product viewable impression\\\";\\n      }\\n      var sponsoredProducts = getEventDetail(\\n        \\\"data.sponsoredProductInformation\\\"\\n      );\\n      var sotV200;\\n      if (sponsoredProducts \\u0026\\u0026 sponsoredProducts.isSponsoredProduct) {\\n        if (\\n          !sponsoredProducts.impressionTrackerId \\u0026\\u0026\\n          !sponsoredProducts.impressionPayload\\n        ) {\\n          sotV200 = null;\\n        } else {\\n          sotV200 =\\n            sponsoredProducts.impressionTrackerId +\\n            \\\";\\\" +\\n            sponsoredProducts.impressionPayload;\\n        }\\n      }\\n    } else if (\\n      rmnBannerEvents.indexOf(linkName) \\u003e -1 ||\\n      newSotTypeRmnBannerEvents.indexOf(linkName) \\u003e -1\\n    ) {\\n      // SMC-1518\\n      linkName =\\n        rmnBannerEvents.indexOf(linkName) \\u003e -1\\n          ? linkName.replace(/_/g, \\\" \\\")\\n          : linkName;\\n      var sponsoredProducts = getEventDetail(\\n        \\\"data.sponsoredProductInformation\\\"\\n      );\\n      var isImpression =\\n        linkName.indexOf(\\\"impression\\\") \\u003e -1 || linkName.indexOf(\\\"view\\\") \\u003e -1\\n          ? true\\n          : false;\\n      if (sponsoredProducts \\u0026\\u0026 sponsoredProducts.isSponsoredProduct) {\\n        if (isImpression) {\\n          var sotV200;\\n          if (\\n            sponsoredProducts.impressionTrackerId == null \\u0026\\u0026\\n            sponsoredProducts.impressionPayload == null\\n          ) {\\n            sotV200 = null;\\n          } else {\\n            sotV200 =\\n              sponsoredProducts.impressionTrackerId +\\n              \\\";\\\" +\\n              sponsoredProducts.impressionPayload;\\n          }\\n        } else {\\n          var sotV191;\\n          if (\\n            sponsoredProducts.clickTrackerId == null \\u0026\\u0026\\n            sponsoredProducts.clickPayload == null\\n          ) {\\n            sotV191 = null;\\n          } else {\\n            sotV191 =\\n              sponsoredProducts.clickTrackerId +\\n              \\\";\\\" +\\n              sponsoredProducts.clickPayload;\\n          }\\n        }\\n      }\\n    }\\n    //SA-398, SA-402\\n    if (homePageSponssoredBannerEvents.indexOf(linkName) \\u003e -1) {\\n      var sponsoredProducts = getEventDetail(\\n        \\\"data.sponsoredProductInformation\\\"\\n      );\\n      var isImpression = linkName.indexOf(\\\"impression\\\") \\u003e -1 ? true : false;\\n      if (sponsoredProducts \\u0026\\u0026 sponsoredProducts.isSponsoredProduct) {\\n        if (isImpression) {\\n          var sotV200;\\n          if (\\n            sponsoredProducts.impressionTrackerId == null \\u0026\\u0026\\n            sponsoredProducts.impressionPayload == null\\n          ) {\\n            sotV200 = null;\\n          } else {\\n            sotV200 =\\n              sponsoredProducts.impressionTrackerId +\\n              \\\";\\\" +\\n              sponsoredProducts.impressionPayload;\\n          }\\n        } else {\\n          var sotV191;\\n          if (\\n            sponsoredProducts.clickTrackerId == null \\u0026\\u0026\\n            sponsoredProducts.clickPayload == null\\n          ) {\\n            sotV191 = null;\\n          } else {\\n            sotV191 =\\n              sponsoredProducts.clickTrackerId +\\n              \\\";\\\" +\\n              sponsoredProducts.clickPayload;\\n          }\\n        }\\n      }\\n    }\\n\\n    //SA-403, SA-404\\n    if (homePageSponssoredCarouselEvents.indexOf(linkName) \\u003e -1) {\\n      var sponsoredProducts = getEventDetail(\\n        \\\"data.sponsoredProductInformation\\\"\\n      );\\n      var isImpression = linkName.indexOf(\\\"impression\\\") \\u003e -1 ? true : false;\\n      if (sponsoredProducts \\u0026\\u0026 sponsoredProducts.isSponsoredProduct) {\\n        if (isImpression) {\\n          var sotV200;\\n          if (\\n            sponsoredProducts.impressionTrackerId == null \\u0026\\u0026\\n            sponsoredProducts.impressionPayload == null\\n          ) {\\n            sotV200 = null;\\n          } else {\\n            sotV200 =\\n              sponsoredProducts.impressionTrackerId +\\n              \\\";\\\" +\\n              sponsoredProducts.impressionPayload;\\n          }\\n        } else {\\n          var sotV191;\\n          if (\\n            sponsoredProducts.clickTrackerId == null \\u0026\\u0026\\n            sponsoredProducts.clickPayload == null\\n          ) {\\n            sotV191 = null;\\n          } else {\\n            sotV191 =\\n              sponsoredProducts.clickTrackerId +\\n              \\\";\\\" +\\n              sponsoredProducts.clickPayload;\\n          }\\n        }\\n      }\\n     }\\n    }\\n    \\n    if (getEventData?.linkName === \\\"carousel_product_click\\\") {\\n      linkName = \\\"carousel product click\\\";\\n      var pageName = getEventData?.sponsoredProductInformation?.pageName;\\n      var carouselName =\\n        getEventData?.sponsoredProductInformation?.carouselName;\\n      var position;\\n      if (carouselName === \\\"Recommended for You\\\") {\\n        position = getEventData?.sponsoredProductInformation?.position;\\n      } else {\\n        position =\\n          parseInt(getEventData?.sponsoredProductInformation?.position, 10) + 1;\\n      }\\n\\n      var carouselProductId =\\n        getEventData?.sponsoredProductInformation?.productId || \\\"\\\";\\n      var sotV36 = pageName ? pageName : null;\\n      var sotV158 = carouselName ? carouselName : null;\\n      var sotV234 = position ? position : null;\\n      var sotV15 = carouselProductId ? carouselProductId : null;\\n    }\\n\\n    var eventDataPayload = {\\n      sysInfo: {\\n        userLanguage: languageLocale,\\n        ipAddress: _satellite.getVar(\\\"[TMS] System Var - IP\\\"),\\n      },\\n      pageInfo: {\\n        title: pageTitle,\\n      },\\n      session: {\\n        profileId: profileId,\\n        platform: platform,\\n        emailId: emailId,\\n        signInState: signInStatus,\\n        timestamp: timestamp,\\n        atgId: _satellite.getVar(\\n          \\\"[TMS] Async :: User :: ATG ID - page load or async page load\\\"\\n        ),\\n      },\\n      sotProps: {\\n        sot20: timestamp + \\\"\\\",\\n      },\\n      sotVars: {\\n        sotV12: fbpValue,\\n        sotV13: ccpaConsentCookie,\\n        sotV15: sotV15,\\n        sotV36: sotV36,\\n        sotV119: _satellite.getVar(\\\"[TMS] Page :: Country\\\"),\\n        sotV158: sotV158,\\n        sotV191: sotV191,\\n        sotV200: sotV200,\\n        sotV201: sephSession,\\n        sotV225: \\\"AL\\\",\\n        sotV226: false,\\n        sotV232: fbcValue,\\n        sotV234: sotV234,\\n        sotV237: _satellite.getVar(\\\"[SOT] Page :: language locale\\\"),\\n        sotV238: timeZone,\\n        sotV246: timeZoneName,\\n        sotV278: _satellite.readCookie(\\\"referrer\\\") || \\\"\\\",\\n        sotV295: sc_click_id,\\n        sotV302: _satellite.readCookie(\\\"ttclid\\\") || \\\"\\\",\\n        sotV303: _satellite.readCookie(\\\"_ttp\\\") || \\\"\\\",\\n        sotV324: new URL(window.location.href).searchParams.get(\\\"gclid\\\"),\\n        sotV325: epikId,\\n        sotV327: _satellite.getVar(\\\"[SOT] :: Forter Token\\\") || \\\"\\\",\\n        sotV349: utm_id,\\n        sotV350: utm_source,\\n        sotV351: utm_medium,\\n        sotV352: utm_campaign,\\n        sotV353: utm_source_platform,\\n        sotV354: utm_term,\\n        sotV355: utm_content,\\n        sotV356: utm_creative_format,\\n        sotV357: utm_marketing_tactic,\\n        sotV361: sessionStorage.getItem('rdt_cid'),\\n        sotV362: _satellite.readCookie('_rdt_uuid') || \\\"\\\",\\n        sotV398: sotV398 || \\\"\\\",\\n        sotV399: _satellite.getVar(\\\"[SOT] Page :: event_date_PST\\\")\\n      },\\n      eventTime: timestamp,\\n      eventId:\\n        _satellite.getVar(\\\"[UEID] :: Universal Event ID Fx\\\")(event) ||\\n        _satellite.getVar(\\\"[TMS] :: Event Id\\\"),\\n    };\\n\\n    switch (linkName) {\\n      case \\\"product edit quantity\\\":\\n        eventDataPayload.sotVars = {\\n          ...eventDataPayload.sotVars,\\n          sotV04: getEventData?.skuId || \\\"\\\",\\n          sotV05: getEventData?.quantity || \\\"\\\",\\n        };\\n        break;\\n\\n      case \\\"beautyboard flagged\\\":\\n      case \\\"beautyboard deletephoto\\\":\\n        eventDataPayload.sotVars = {\\n          ...eventDataPayload.sotVars,\\n          sotV18: getEventData?.photoId || \\\"\\\",\\n        };\\n        break;\\n\\n      case \\\"here for curbside click\\\":\\n        eventDataPayload.sotVars = {\\n          ...eventDataPayload.sotVars,\\n          sotV10: getEventData?.orderId || null,\\n        };\\n        break;\\n\\n      case \\\"apply creditcard reward\\\":\\n        eventDataPayload.sotVars = {\\n          ...eventDataPayload.sotVars,\\n          sotV28: getEventData?.promoId || null,\\n        };\\n        break;\\n\\n      case \\\"forgot password email sent\\\":\\n      case \\\"forgot password email resent\\\":\\n        eventDataPayload.sotVars = {\\n          ...eventDataPayload.sotVars,\\n          sotV257: getEventData?.emailId ?? null,\\n        };\\n        break;\\n\\n      default:\\n        break;\\n    }\\n\\n    if (autoReplenishEvents.indexOf(linkName) !== -1) {\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV04: getEventData?.skuId || \\\"\\\",\\n        sotV06: getEventData?.price || \\\"\\\",\\n        sotV05: getEventData?.quantity || \\\"\\\",\\n        sotV229: getEventData?.replenishmentFreqNum || \\\"\\\",\\n        sotV230: getEventData?.replenishmentFreqType || \\\"\\\",\\n        sotV231: getEventData?.status || \\\"\\\",\\n      };\\n    }\\n\\n    // SA-1025, SA-1022, SA-1023, SA-1024\\n    if (getEventData?.linkName \\u0026\\u0026 happeningAtSephoraEvents.includes(linkName)) {\\n      const {\\n        reservationName: sotV169 = \\\"\\\",\\n        storeId: sotV98 = \\\"\\\",\\n        activityId: sotV171 = \\\"\\\",\\n        activityType: sotV172 = \\\"\\\",\\n      } = getEventData;\\n\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV169,\\n        sotV98,\\n        sotV171,\\n        sotV172,\\n      };\\n    }\\n\\n    //SA-1117\\n    if (\\n      getEventData?.linkName === \\\"see order details \\u0026 get sms updates click\\\"\\n    ) {\\n      linkName = \\\"see order details and get sms updates click\\\";\\n    }\\n\\n    //SA-1458\\n    if (getEventData?.linkName === \\\"product alt image swatch size\\\") {\\n      const {\\n        skuId = \\\"\\\",\\n        quantity = \\\"\\\",\\n        listPrice = \\\"\\\",\\n        brandName = \\\"\\\",\\n        productId = \\\"\\\",\\n        shippingMethod = \\\"\\\",\\n        customerZipCode = \\\"\\\",\\n        isOnlineOnly = false,\\n        isSameDayEligibleSku = false,\\n        topCategory = {},\\n        storeId = \\\"\\\",\\n        isOutOfStock = false,\\n      } = getEventData;\\n\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV04: skuId,\\n        sotV05: quantity,\\n        sotV06: listPrice,\\n        sotV07: brandName,\\n        sotV15: productId,\\n        sotV63: shippingMethod,\\n        sotV187: customerZipCode,\\n        sotV188: isOnlineOnly ? \\\"Yes\\\" : \\\"No\\\",\\n        sotV189: isSameDayEligibleSku ? \\\"Yes\\\" : \\\"No\\\",\\n        sotV192: topCategory.displayName || \\\"\\\",\\n        sotV193: storeId,\\n        sotV199: isOutOfStock ? \\\"Out of Stock\\\" : \\\"In Stock\\\",\\n      };\\n    }\\n\\n    //SA-1261\\n    if (\\n      getEventData?.linkName \\u0026\\u0026\\n      beautyPreferencesSaveEvents.includes(getEventData?.linkName)\\n    ) {\\n      let eventData = getEventDetail(\\\"data\\\");\\n      const keysToExtract = [\\n        \\\"selectedAccordionName\\\",\\n        \\\"skinType\\\",\\n        \\\"skinConcerns\\\",\\n        \\\"skinTone\\\",\\n        \\\"colorIQ\\\",\\n        \\\"ingredientPreferences\\\",\\n        \\\"fragrancePreferences\\\",\\n        \\\"hairDescrible\\\",\\n        \\\"hairTexture\\\",\\n        \\\"hairConcerns\\\",\\n        \\\"hairColor\\\",\\n        \\\"shoppingPreferences\\\",\\n        \\\"favoriteBrands\\\",\\n        \\\"eyeColor\\\",\\n        \\\"ageRange\\\",\\n        \\\"completionPercentage\\\",\\n      ];\\n\\n      const beautyPreferencesObj = {};\\n\\n      for (const key of keysToExtract) {\\n        if (key === \\\"colorIQ\\\") {\\n          // Special handling for the \\\"colorIQ\\\" property\\n          beautyPreferencesObj[`sotV${keysToExtract.indexOf(key) + 260}`] =\\n            Array.isArray(eventData[key])\\n              ? eventData[key].map((item) =\\u003e item.description).join(\\\";\\\")\\n              : \\\"\\\";\\n        } else {\\n          beautyPreferencesObj[`sotV${keysToExtract.indexOf(key) + 260}`] =\\n            Array.isArray(eventData[key])\\n              ? eventData[key].join(\\\";\\\")\\n              : eventData[key] || \\\"\\\";\\n        }\\n      }\\n      Object.assign(eventDataPayload.sotVars, beautyPreferencesObj);\\n    }\\n\\n    if (viewBasketAndCheckoutEvent.includes(getEventData?.linkName)) {\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV04: getEventData.skuIds || \\\"\\\",\\n        sotV63: getEventData.shippingMethod || \\\"\\\",\\n        sotV11: getEventData.listSubTotal || \\\"\\\",\\n      };\\n    } else if (addAllToBasket.includes(getEventData?.linkName)) {\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV04: getEventData.skuIds || \\\"\\\",\\n        sotV15: getEventData.productIds || \\\"\\\",\\n      };\\n    } else if (productFinderQuiz.includes(getEventData?.linkName)) {\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV185: getEventData.questionNumber || \\\"\\\",\\n        sotV186: getEventData.questionText || \\\"\\\",\\n      };\\n    } else if (cardDetails.includes(getEventData?.linkName)) {\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV155: getEventData.pageType || \\\"\\\",\\n        sotV156: getEventData.sectionTitle || \\\"\\\",\\n      };\\n    } else if (beautyPreferencesEvents.includes(getEventData?.linkName)) {\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV260: getEventData.accordionName || \\\"\\\",\\n      };\\n    } else if (medalliaEvents.includes(getEventData?.linkName)) {\\n      eventDataPayload.sotVars = {\\n        ...eventDataPayload.sotVars,\\n        sotV247: getEventData?.formId || \\\"\\\",\\n        sotV248: getEventData?.formType || \\\"\\\",\\n      };\\n    }\\n\\n    var callNewEvtApi = false;\\n    var callNewEvtApiEvents = rmnEvents.concat(\\n      rmnImpressionEvents,\\n      rmnBannerEvents,\\n      newSotTypeRmnEvents,\\n      newSotTypeRmnImpressionEvents,\\n      newSotTypeRmnBannerEvents,\\n      onSiteOnloadEvents,\\n      set14OnwardsEvents,\\n      autoReplenishEvents,\\n      homePageSponssoredBannerEvents,\\n      homePageSponssoredCarouselEvents,\\n      sduEvents,\\n      medalliaEvents,\\n      bbqSignIn,\\n      placeOrderEvents,\\n      happeningAtSephoraEvents,\\n      beautyPreferencesEvents,\\n      beautyPreferencesSaveEvents,\\n      viewBasketAndCheckoutEvent,\\n      addAllToBasket,\\n      productFinderQuiz,\\n      cardDetails,\\n      [\\\"bestseller carousel product click\\\"],\\n      [\\\"pla sponsored carousel click\\\"]\\n    );\\n    if (callNewEvtApiEvents.indexOf(linkName) \\u003e -1) {\\n      callNewEvtApi = true;\\n    }\\n    var isValidLinkName = getValidLinkName(linkName);\\n    if (isValidLinkName) {\\n      if (allowedLinkActionInfo.indexOf(linkName) != -1 || isBasketSwitch) {\\n        if (sduEvents.indexOf(linkName) \\u003e -1) {\\n          (window.sephoraOneTag_cmds = window.sephoraOneTag_cmds || []).push([\\n            \\\"trackEvent\\\",\\n            linkName,\\n            eventDataPayload,\\n            null,\\n            callNewEvtApi,\\n          ]);\\n        } else {\\n          (window.sephoraOneTag_cmds = window.sephoraOneTag_cmds || []).push([\\n            \\\"trackEvent\\\",\\n            formatSotType(linkName),\\n            eventDataPayload,\\n            null,\\n            callNewEvtApi,\\n          ]);\\n        }\\n      }\\n    }\\n  } catch (error) {\\n    console.log(\\n      \\\"Failed in SOT - Link Page Tracking (SOTLINKTRACKING) Tag\\\",\\n      error\\n    );\\n  }\\n})();\\n\",\"language\":\"javascript\"}"
    },
    "relationships": {
        "updated_with_extension_package": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756/updated_with_extension_package"
            },
            "data": {
                "id": "EP1fdd2a6ec2ae468fb1d2cac08df65f83",
                "type": "extension_packages"
            }
        },
        "updated_with_extension": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756/updated_with_extension"
            },
            "data": {
                "id": "EX35ce3802460d499b9f4c856d69a764b4",
                "type": "extensions"
            }
        },
        "extension": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756/extension"
            },
            "data": {
                "id": "EX881e591abc3d4b29b9681e2a4d337f74",
                "type": "extensions"
            }
        },
        "notes": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756/notes"
            }
        },
        "origin": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756/origin"
            },
            "data": {
                "id": "RC29cb2018013a4df192b62cb29a78a756",
                "type": "rule_components"
            }
        },
        "property": {
            "links": {
                "related": "https://reactor.adobe.io/properties/PR28bc45fcba184e70b64b2f0cf7fe70f8"
            },
            "data": {
                "id": "PR28bc45fcba184e70b64b2f0cf7fe70f8",
                "type": "properties"
            }
        },
        "rules": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756/rules"
            }
        }
    },
    "links": {
        "extension": "https://reactor.adobe.io/extensions/EX881e591abc3d4b29b9681e2a4d337f74",
        "origin": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756",
        "rules": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756/rules",
        "self": "https://reactor.adobe.io/rule_components/RC29cb2018013a4df192b62cb29a78a756"
    },
    "meta": {
        "latest_revision_number": 273
    }
}
