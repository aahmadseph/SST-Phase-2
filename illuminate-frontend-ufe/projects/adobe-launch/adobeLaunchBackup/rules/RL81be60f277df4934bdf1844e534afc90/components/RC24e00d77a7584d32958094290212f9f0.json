{
    "id": "RC24e00d77a7584d32958094290212f9f0",
    "type": "rule_components",
    "attributes": {
        "created_at": "2022-09-26T10:27:54.264Z",
        "delegate_descriptor_id": "core::actions::custom-code",
        "deleted_at": null,
        "dirty": false,
        "name": "SOT - Link Page Tracking",
        "negate": false,
        "order": 1,
        "rule_order": 50,
        "timeout": 2000,
        "delay_next": true,
        "published": false,
        "published_at": null,
        "revision_number": 0,
        "updated_at": "2025-07-09T12:35:24.239Z",
        "created_by_email": "Naveen.Vinala@sephora.com",
        "created_by_display_name": "Naveen Vinala",
        "updated_by_email": "abhinav.alkuchi@sephora.com",
        "updated_by_display_name": "abhinav alkuchi",
        "settings": "{\"source\":\"(async function () {\\n  function readCookie(name) {\\n    let nameEQ = name + \\\"=\\\";\\n    let ca = document.cookie.split(\\\";\\\");\\n    for (let i = 0; i \\u003c ca.length; i++) {\\n      let c = ca[i];\\n      while (c.charAt(0) === \\\" \\\") c = c.substring(1, c.length);\\n      if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);\\n    }\\n    return null;\\n  }\\n  \\n   function mergeSotVars(from, to) {\\n      if (from \\u0026\\u0026 from.sotVars \\u0026\\u0026 to \\u0026\\u0026 to.sotVars) {\\n        var fromKeys = Object.keys(from.sotVars);\\n        for (var i = 0; i \\u003c fromKeys.length; i++) {\\n          var fromKey = fromKeys[i];\\n          if (fromKey \\u0026\\u0026 !to.sotVars[fromKey]) {\\n            to.sotVars[fromKey] = from.sotVars[fromKey];\\n          }\\n        }\\n      }\\n      return to;\\n    }\\n  \\n    function mergeObjects() {\\n      var resObject = {};\\n      for (var i = 0; i \\u003c arguments.length; i++) {\\n        var obj = arguments[i];\\n        var keys = obj ? Object.keys(obj) : [];\\n        for (var j = 0; j \\u003c keys.length; j++) {\\n          if (resObject[keys[j]]) {\\n            resObject[keys[j]] = mergeObjects(resObject[keys[j]], obj[keys[j]]);\\n          } else {\\n            resObject[keys[j]] = obj[keys[j]];\\n          }\\n        }\\n      }\\n      return resObject;\\n    }\\n\\n  function getEventAttribute(attributePath) {\\n    let recentProp = Sephora.analytics.utils.getMostRecentEventProperty({\\n      pathToProperty: attributePath,\\n      fallBackEventName: Sephora.analytics.constants.LINK_TRACKING_EVENT,\\n    });\\n    //console.log(\\\"!SOT Logs recentProp\\\", recentProp);\\n    return recentProp;\\n  }\\n\\n  function getItemQty(skuId, removeFromBasket) {\\n    let basketItemss = digitalData.cart.item;\\n    if (removeFromBasket \\u0026\\u0026 digitalData.cart.itemBeforeUpdate) {\\n      basketItemss = digitalData.cart.itemBeforeUpdate;\\n    }\\n    var itemsByBasket = basketItemss.find((item) =\\u003e item.sku.skuId === skuId);\\n    return itemsByBasket \\u0026\\u0026 itemsByBasket.qty ? itemsByBasket.qty : 1;\\n  }\\n\\n  function getLowInStockStatus(stockAvailability) {\\n    return stockAvailability === \\\"Out of Stock\\\" ? \\\"n/a\\\" : stockAvailability === \\\"Limited Stock\\\" ? \\\"Yes\\\" : \\\"No\\\";\\n  }\\n\\n  function setIfNotNull(obj, prop, value) {\\n    if (obj \\u0026\\u0026 value !== null \\u0026\\u0026 typeof value !== \\\"undefined\\\") {\\n      obj[prop] = value;\\n    }\\n    return obj;\\n  }\\n\\n  function safelyReadProperty(attributePath, objectInfo) {\\n    return Sephora.analytics.utils.safelyReadProperty(\\n      attributePath,\\n      objectInfo\\n    ) || \\\"\\\";\\n  }\\n\\n  function getEventDetail(attributePath) {\\n    return event.detail ? safelyReadProperty(attributePath, event.detail) : \\\"\\\";\\n  }\\n\\n  function getSkuPrice() {\\n    if (digitalData.product === null) {\\n      return null;\\n    } else {\\n      return (\\n        digitalData.product[0] \\u0026\\u0026\\n        digitalData.product[0].attributes \\u0026\\u0026\\n        digitalData.product[0].attributes.price\\n      );\\n    }\\n  }\\n\\n  function getProductName() {\\n    if (digitalData.product === null || digitalData.product.length === 0) {\\n      return null;\\n    } else {\\n      return (\\n        digitalData.product[0] \\u0026\\u0026\\n        digitalData.product[0].productInfo \\u0026\\u0026\\n        digitalData.product[0].productInfo.productName\\n      );\\n    }\\n  }\\n\\n  function getSkuId(skuId) {\\n    let eventAttribute = getEventAttribute(\\\"eventInfo.attributes\\\");\\n    if (\\n      eventAttribute.pageName.indexOf(\\\"chat:home chat\\\") !== -1 \\u0026\\u0026\\n      eventAttribute.pageType === \\\"chat\\\" \\u0026\\u0026\\n      eventAttribute.productStrings\\n    ) {\\n      return eventAttribute.productStrings.split(\\\";\\\")[1];\\n    } else {\\n      return skuId;\\n    }\\n  }\\n\\n  function getProductNthLevelCategory() {\\n    if (digitalData.product \\u0026\\u0026 digitalData.product[0]) {\\n      return (\\n        (digitalData.product[0].attributes \\u0026\\u0026\\n          digitalData.product[0].attributes.nthLevelCategory) ||\\n        \\\"n/a\\\"\\n      );\\n    } else {\\n      return \\\"n/a\\\";\\n    }\\n  }\\n\\n  function formatSotType(sotType) {\\n    return sotType \\u0026\\u0026 sotType.toLowerCase().replace(/([\\\\:\\\\-])/g, \\\" \\\");\\n  }\\n\\n  function getValidLinkName(sotType) {\\n    if (\\n      typeof sotType === \\\"undefined\\\" ||\\n      sotType === null ||\\n      sotType === \\\"null\\\"\\n    ) {\\n      return false;\\n    }\\n    return true;\\n  }\\n  //SA-1043\\n  function getBasketItemSkuIds() {\\n    let cartItems = digitalData.cart.item || [];\\n    let skuIds = \\\"\\\";\\n    if (cartItems \\u0026\\u0026 cartItems.length \\u003e 0) {\\n      cartItems.map((item, index) =\\u003e {\\n        if (item \\u0026\\u0026 item.sku \\u0026\\u0026 item.sku.skuId) {\\n          skuIds +=\\n            item.sku.skuId + (cartItems.length - 1 === index ? \\\"\\\" : \\\";\\\");\\n        }\\n      });\\n    }\\n    return skuIds;\\n  }\\n\\n  // SA-988\\n  function getWishListSkuIds() {\\n    let shoppingList = safelyReadProperty(\\n        \\\"Util.InflatorComps.services.UserInfo.data.shoppingList.shoppingListItems\\\",\\n        Sephora\\n      ),\\n      wishList = [];\\n    if (shoppingList \\u0026\\u0026 shoppingList.length) {\\n      for (var i = 0; i \\u003c shoppingList.length; i++) {\\n        wishList.push(shoppingList[i].sku.skuId || \\\"\\\");\\n      }\\n    }\\n    return wishList.length ? wishList.join(\\\";\\\") : \\\"\\\";\\n  }\\n\\n  //SA-1198\\n  function getProductIdforSotV15(eventProductId, eventPageDetail) {\\n    let sotV15 = \\\"\\\";\\n    if (eventProductId) {\\n      sotV15 = eventProductId;\\n    } else if (eventPageDetail) {\\n      sotV15 = eventPageDetail;\\n    } else if (digitalData?.product?.[0]?.productInfo?.productID) {\\n      sotV15 = digitalData.product[0].productInfo.productID;\\n    }\\n    return sotV15;\\n  }\\n\\n  //SA-1175\\n  function getShippingMethodFromLinkName(method) {\\n    if (!method || method.indexOf(\\\"change method\\\") === -1) {\\n      return {};\\n    }\\n    const [previousMethod, changedMethod] = method.split(\\\":\\\").slice(-2);\\n    return {\\n      previousMethod,\\n      changedMethod,\\n    };\\n  }\\n\\n  //SA-1174\\n  function getParentCategoryFromSkuList(obj, searchKey) {\\n    let results = [];\\n    for (const key in obj) {\\n      if (key === searchKey \\u0026\\u0026 typeof obj[key] !== \\\"object\\\") {\\n        results.push(obj[key]);\\n      } else if (typeof obj[key] === \\\"object\\\") {\\n        results = results.concat(\\n          getParentCategoryFromSkuList(obj[key], searchKey)\\n        );\\n      }\\n    }\\n    return results.length \\u003e 0 ? results[results.length - 1] : \\\"\\\";\\n  }\\n\\n  function getCurrency() {\\n    const basketData = window.localStorage.getItem(\\\"basket\\\");\\n\\n    if (!basketData) {\\n      return digitalData?.page?.pageInfo?.country === \\\"US\\\" ? \\\"USD\\\" : \\\"CAD\\\";\\n    }\\n\\n    try {\\n      const parsedData = JSON.parse(basketData);\\n      return parsedData?.data?.currency || (digitalData?.page?.pageInfo?.country === \\\"US\\\" ? \\\"USD\\\" : \\\"CAD\\\");\\n    } catch (error) {\\n      console.error(\\\"Error parsing basket data:\\\", error);\\n      return digitalData?.page?.pageInfo?.country === \\\"US\\\" ? \\\"USD\\\" : \\\"CAD\\\";\\n    }\\n  }\\n\\n  //SA-1636\\n  function getPreferredStoreId() {\\n    return digitalData?.product?.[0]?.attributes?.preferredStore || \\\"\\\";\\n  }\\n\\n  function getCustomerZipCode() {\\n    return digitalData?.page?.attributes?.customerZipCode || \\\"\\\";\\n  }\\n\\n\\n  function getLinkName() {\\n    let linkName = \\\"\\\";\\n    if (getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.linkName\\\")) {\\n      linkName = getEventDetail(\\\"data.linkName\\\");\\n    } else {\\n      linkName = getEventAttribute(\\\"eventInfo.attributes.linkName\\\");\\n    }\\n    return linkName;\\n  }\\n\\n  function convertMobileNumber(phoneNumber) {\\n    return phoneNumber ? phoneNumber.replace(/\\\\D/g, \\\"\\\") : \\\"n/a\\\";\\n  }\\n\\n  function getValuesFromResponse(obj, keys) {\\n    let result = {};\\n\\n    function recurse(currentObj, currentPath) {\\n      for (let key in currentObj) {\\n        if (currentObj[key] \\u0026\\u0026 typeof currentObj[key] === \\\"object\\\") {\\n          recurse(currentObj[key], currentPath.concat([key]));\\n        } else {\\n          if (keys.includes(key)) {\\n            result[key] = currentObj[key];\\n          }\\n        }\\n      }\\n    }\\n    recurse(obj, []);\\n    return result;\\n  }\\n\\n  function getBasketTypeName(basketType, item = {}) {\\n    const basketTypeNames = {\\n      sameday: \\\"same day delivery\\\",\\n      pickup: \\\"buy online and pick up\\\",\\n      shiptohome: \\\"standard\\\",\\n    };\\n    if (basketType === \\\"shiptohome\\\" \\u0026\\u0026 item?.isReplenishment) {\\n      return \\\"auto replenish\\\";\\n    }\\n    return basketTypeNames[basketType] || \\\"standard\\\";\\n  }\\n\\n  function getBasketType(skuId) {\\n    const data = digitalData.cart.itemsByBasket || [];\\n    for (const entry of data) {\\n      for (const item of entry.items) {\\n        if (item.sku.skuId === skuId) {\\n          const basketType = entry.basketType.toLowerCase();\\n          return getBasketTypeName(basketType, item);\\n        }\\n      }\\n    }\\n    return null;\\n  }\\n\\n  function getProductNameByProductId(productId) {\\n    let products = digitalData.product || [];\\n    if (products \\u0026\\u0026 products.length \\u003e 0 \\u0026\\u0026 productId) {\\n      for (let i = 0; i \\u003c products.length; i++) {\\n        if (products[i].productInfo.productID === productId) {\\n          return products[i].productInfo.productName;\\n        }\\n      }\\n    }\\n    return null;\\n  }\\n\\n  function getParentCategoryFromDigitalData(skuId) {\\n    let itemArray = digitalData.cart.item || [];\\n    const item = itemArray.find((item) =\\u003e item.sku.skuId === skuId);\\n    if (item \\u0026\\u0026 item.sku \\u0026\\u0026 item.sku.parentCategory) {\\n      let parentCategory = item.sku.parentCategory;\\n      let sotV192 = getParentCategoryFromSkuList(parentCategory, \\\"displayName\\\");\\n      return sotV192;\\n    } else {\\n      return null;\\n    }\\n  }\\n\\n  function checkRemoveFromBasketEvents(actionInfo, events) {\\n    return (\\n      events.some((event) =\\u003e\\n        actionInfo.toLowerCase().includes(event.toLowerCase())\\n      ) || false\\n    );\\n  }\\n\\n  function getBasketSkuIdsFromLocalStorage() {\\n    const basketDataFromLocalStorage = localStorage.getItem(\\\"basket\\\");\\n    if (!basketDataFromLocalStorage) {\\n      return \\\"\\\";\\n    }\\n    const parseData = JSON.parse(basketDataFromLocalStorage);\\n    const basketItems = parseData?.data?.items || [];\\n    const extractSkuIds = (items) =\\u003e {\\n      return items\\n        .map((item) =\\u003e (item.sku ? item.sku.skuId : null))\\n        .filter((skuId) =\\u003e skuId !== null);\\n    };\\n    const extractedSkuIds = extractSkuIds(basketItems);\\n    return extractedSkuIds.length \\u003e 0 ? extractedSkuIds.join(\\\";\\\") : getBasketItemSkuIds() || null;\\n  }\\n\\n  function getDataFromSessionStorage(key) {\\n    const data = sessionStorage.getItem(key);\\n    return data ? JSON.parse(data) : null;\\n  }\\n\\n  function getShippingWithSkuIDs() {\\n    const baskets = digitalData?.cart?.itemsByBasket || [];\\n    const shippingMethods = {};\\n    baskets.forEach((basket) =\\u003e {\\n      const shippingMethod = basket?.basketType?.toLowerCase();\\n      basket.items.forEach((item) =\\u003e {\\n        const skuId = item.sku.skuId;\\n        const method = item.isReplenishment ? \\\"auto replenish\\\" : shippingMethod;\\n        if (!shippingMethods[method]) {\\n          shippingMethods[method] = [];\\n        }\\n        shippingMethods[method].push(skuId);\\n      });\\n    });\\n    return (\\n      Object.entries(shippingMethods)\\n        .map(([method, ids]) =\\u003e {\\n          const basketMethodName = method !== \\\"auto replenish\\\" ? getBasketTypeName(method) : \\\"auto replenish\\\";\\n          return `${basketMethodName}:${ids.join(\\\",\\\")}`;\\n        })\\n        .join(\\\";\\\") || \\\"\\\"\\n    );\\n  }\\n  \\n  function checkTheErrorMessage() {\\n   const errorMessageFromEventDetail = getEventDetail(\\\"data.errorMessages\\\") || [];\\n   return errorMessageFromEventDetail.length \\u003e 0 ? errorMessageFromEventDetail.some(msg =\\u003e msg.includes(\\\"device is already exists\\\"))\\n     : false;\\n  }\\n  \\n  function getProductImageUrl(skuId) {\\n    return `https://www.sephora.com/productimages/sku/s${skuId}-main-zoom.jpg`;\\n  }\\n  \\n  function constructProductSkuImageURL(image, skuId) {\\n    let imageUrl = \\\"\\\";\\n    if(image \\u0026\\u0026 image.includes('?imwidth')) {\\n      imageUrl = image.split('?imwidth')[0];\\n    } else if(skuId) {\\n      imageUrl = getProductImageUrl(skuId);\\n    }\\n    return imageUrl;\\n  }\\n\\n\\n  try {\\n    var cartSkuIds = getBasketSkuIdsFromLocalStorage() || \\\"n/a\\\";\\n    let linkName = getLinkName();\\n    const actionInfo = getEventAttribute(\\\"eventInfo.attributes.actionInfo\\\");\\n    const eventProductId = getEventAttribute(\\\"eventInfo.attributes.productId\\\");\\n    const eventPageDetail = getEventAttribute(\\\"eventInfo.attributes.pageDetail\\\");\\n    let linkTrackingEvents = JSON.parse(_satellite.getVar(\\\"[TMS] :: Link Tracking Events\\\"));\\n    let sampleBasket = actionInfo === \\\"Add Sample To Basket\\\";\\n    let {platform, languageLocale} = digitalData.page.attributes;\\n    languageLocale = languageLocale?.toLowerCase()?.slice(-2);\\n    const emailId = digitalData?.user?.[0]?.profile?.[0]?.profileInfo?.email || \\\"\\\";\\n    const signInStatus = digitalData?.user?.[0]?.segment?.signInStatus || \\\"\\\";\\n    let pageTitle = safelyReadProperty(\\\"page.attributes.sephoraPageInfo.pageName\\\",digitalData) || \\\"\\\";\\n    const profileId = digitalData?.user?.[0]?.profile?.[0]?.profileInfo?.profileID || \\\"\\\";\\n    let sotSubType = safelyReadProperty(\\\"page.category.pageType\\\",digitalData) || \\\"\\\";\\n    let sotSubCategory = getProductNthLevelCategory();\\n    let pageTypeDetail = safelyReadProperty(\\\"page?.pageInfo?.pageName\\\", digitalData).toLowerCase() || \\\"\\\";\\n    let pageWorld = safelyReadProperty(\\\"page.attributes.world\\\", digitalData).toLowerCase() || \\\"n/a\\\";\\n    let skuPrice = getSkuPrice();\\n    let skuBrand = digitalData?.product?.[0]?.productInfo?.manufacturer?.toLowerCase() || \\\"none\\\";\\n    const biAccountId = digitalData?.user?.[0]?.segment?.biAccountId || \\\"\\\";\\n    const biStatus = digitalData?.user?.[0]?.segment?.biStatus || \\\"\\\";\\n    const biPoints = digitalData?.user?.[0]?.segment?.biPoints || \\\"\\\";\\n    let sotV365 = profileId \\u0026\\u0026 await Sephora?.analytics?.utils?.hashString(profileId);\\n    let sotV366 = biAccountId \\u0026\\u0026 await Sephora?.analytics?.utils?.hashString(biAccountId);\\n\\n    //Event attributes\\n    let itemEventDetail = getEventDetail(\\\"data.item\\\");\\n    let skuIdEventDetail = itemEventDetail?.[0]?.sku?.skuId || \\\"\\\";\\n    let productSkuIdId = getEventAttribute(\\\"eventInfo.attributes.skuId\\\") || getEventDetail(\\\"data.sku.skuId\\\") || (linkName === \\\"Add To Loves\\\" \\u0026\\u0026 skuIdEventDetail);\\n    let categoryId = getProductNthLevelCategory();\\n    let categoryIdBasketCache = Sephora?.Util?.getBasketCache({})?.items?.filter(i =\\u003e i?.sku?.productId === digitalData?.product[0]?.productInfo?.productID)[0]?.sku?.parentCategory?.categoryId;\\n    const addToBasketActions = [\\\"basket:edit quantity:increase\\\",\\\"Add To Basket\\\",\\\"Add To Basket For Store Pickup\\\",\\\"add to basket\\\",\\\"add to basket for same day delivery\\\",sampleBasket];\\n    if (addToBasketActions.includes(linkName)) {\\n      linkName = \\\"Add To Basket\\\";\\n    } else if (linkName === \\\"love\\\") {\\n      linkName = \\\"Add To Loves\\\";\\n    }\\n\\n    const mapShippingMethods = {\\n      ShipToHome: \\\"standard\\\",\\n      sameday: \\\"same day delivery\\\",\\n      ROPIS: \\\"bopis\\\",\\n    };\\n\\n    let shippingMethod = digitalData?.product?.[0]?.productInfo?.shippingMethod || \\\"\\\";\\n    shippingMethod = mapShippingMethods[shippingMethod] || shippingMethod;\\n\\n    const orderId = location.href.split(\\\"orderId=\\\")[1] || location.href.split(\\\"orderdetail/\\\")[1];\\n    const allowTracking = linkTrackingEvents[linkName] \\u0026\\u0026 ([\\\"Add To Basket\\\", \\\"Add To Loves\\\", \\\"video popup\\\"].includes(linkName));\\n    const timestamp = new Date().getTime();\\n    let ipAddress = await _satellite.getVar(\\\"[SOT] System :: IP Address\\\");\\n    const ccpaConsentCookie = readCookie(\\\"ccpaConsentCookie\\\") === '1' ? 1 : 0;\\n    const fbpValue = readCookie(\\\"_fbp\\\");\\n    const fbcValue = readCookie(\\\"_fbc\\\");\\n    const sc_click_id = sessionStorage.getItem(\\\"sc_click_id\\\") || \\\"\\\";\\n    let epikLS = JSON.parse(window.localStorage.getItem(\\\"_epik_ls\\\"));\\n    let epikLSValid = epikLS?.expires \\u0026\\u0026 epikLS?.value \\u0026\\u0026 !isNaN(new Date(epikLS.expires)) \\u0026\\u0026 new Date(epikLS.expires) \\u003e= new Date();\\n    let epikId = new URL(window.location.href).searchParams.get(\\\"epik\\\") || _satellite.cookie.get(\\\"_epik\\\") || (epikLSValid \\u0026\\u0026 epikLS.value) || \\\"\\\";\\n\\n    const utmParameters = JSON.parse(window.localStorage.getItem(\\\"utmParameters\\\"));\\n    const allowUtm = utmParameters?.expiration \\u003e= new Date().getTime() ? true : \\\"\\\";\\n    const {\\n      utm_id,\\n      utm_source,\\n      utm_medium,\\n      utm_campaign,\\n      utm_source_platform,\\n      utm_term,\\n      utm_content,\\n      utm_creative_format,\\n      utm_marketing_tactic\\n    } = allowUtm ? utmParameters : {};\\n    const lowerCaseParams = new URLSearchParams(\\n      Array.from(new URLSearchParams(new URL(window.location.href).search), ([key, value]) =\\u003e [key.toLowerCase(), value])\\n    );\\n    const rdtCidURL = lowerCaseParams.get('rdt_cid');\\n    rdtCidURL \\u0026\\u0026 sessionStorage.setItem('rdt_cid', rdtCidURL);\\n\\n    //Adobe variables\\n    let dataToSend = {\\n      sotVars: {\\n        sotV01: pageTypeDetail,\\n        sotV10: orderId,\\n        sotV12: fbpValue,\\n        sotV232: fbcValue,\\n        sotV170: \\\"adobe triggered\\\",\\n        sotV13: ccpaConsentCookie,\\n        sotV14: _satellite.getVar(\\\"[TMS] Link :: Event Strings\\\"),\\n        sotV16: _satellite.getVar(\\\"[TMS] Link :: Link Name\\\"),\\n        sotV17: _satellite.getVar(\\\"[TMS] Link :: Platform\\\"),\\n        sotV18: _satellite.getVar(\\\"[TMS] Beauty Board :: Photo ID\\\"),\\n        sotV19: _satellite.getVar(\\\"[TMS] Link :: Experience\\\"),\\n        sotV20: _satellite.getVar(\\\"[TMS] Color IQ :: Save To Profile\\\"),\\n        sotV21: _satellite.getVar(\\\"[TMS] Link :: Video Name\\\"),\\n        sotV22: _satellite.getVar(\\\"[TMS] Link :: External Recommendation Info\\\"),\\n        sotV23: _satellite.getVar(\\\"[TMS] Link :: Happening Filters\\\"),\\n        sotV24: _satellite.getVar(\\\"[TMS] Link :: Sku Type\\\"),\\n        sotV25: _satellite.getVar(\\\"[TMS] Link :: Language Locale\\\"),\\n        sotV26: _satellite.getVar(\\\"[TMS] Link :: eVar63\\\"),\\n        sotV27: _satellite.getVar(\\\"[TMS] Link :: Previous Navigation Information\\\"),\\n        sotV28: _satellite.getVar(\\\"[TMS] Link :: User Input\\\"),\\n        sotV29: _satellite.getVar(\\\"[TMS] Link :: Server Response\\\"),\\n        sotV30: _satellite.getVar(\\\"[TMS] Link :: BI Real-time Point Status\\\"),\\n        sotV31: _satellite.getVar(\\\"[TMS] Link :: Add To Basket Location\\\"),\\n        sotV32: _satellite.getVar(\\\"[TMS] Link :: Internal Campaign String\\\"),\\n        sotV33: _satellite.getVar(\\\"[TMS] Link :: Page Type\\\"),\\n        sotV34: _satellite.getVar(\\\"[TMS] Link :: Page Detail\\\"),\\n        sotV35: _satellite.getVar(\\\"[TMS] Link :: Page World\\\"),\\n        sotV36: _satellite.getVar(\\\"[TMS] Link :: Page Name\\\"),\\n        sotV37: _satellite.getVar(\\\"[TMS] Link :: biChipType\\\"),\\n        sotV38: _satellite.getVar(\\\"[TMS] Link :: External Recommendation Info\\\"),\\n        sotV39: _satellite.getVar(\\\"[TMS] Link :: Filter Selections\\\"),\\n        sotV40: _satellite.getVar(\\\"[TMS] Link :: Previous Page\\\"),\\n        sotV41: _satellite.getVar(\\\"[TMS] Link :: Search Criteria\\\"),\\n        sotV42: _satellite.getVar(\\\"[TMS] Link :: Product Answers Keyword\\\"),\\n        sotV43: _satellite.getVar(\\\"[TMS] Link :: Field Errors\\\"),\\n        sotV44: _satellite.getVar(\\\"[TMS] Link :: Validation Error Messages\\\"),\\n        sotV45: _satellite.getVar(\\\"[TMS] User :: Accepted Advertising Cookies\\\"),\\n        sotV46: \\\"D=v62\\\",\\n        sotV47: _satellite.getVar(\\\"[TMS] Link :: Error Messages\\\"),\\n        sotV48: _satellite.getVar(\\\"[TMS] Pixel :: Braze :: User ID\\\"),\\n        sotV49: _satellite.getVar(\\\"[TMS] Pixel :: Braze :: letiation Name\\\"),\\n        sotV50: _satellite.getVar(\\\"[TMS] Pixel :: Braze :: Campaign Name\\\"),\\n        sotV51: _satellite.getVar(\\\"[TMS] Link :: Medallia Form\\\"),\\n        sotV119: _satellite.getVar(\\\"[TMS] Page :: Country\\\"),\\n        sotV149: _satellite.getVar(\\\"[TMS] Link :: Product Strings\\\").toString() || \\\"\\\",\\n        sotV225: \\\"AL\\\",\\n        sotV226: false,\\n        sotV237: _satellite.getVar(\\\"[SOT] Page :: language locale\\\"),\\n        sotV238: safelyReadProperty(\\\"page.attributes.date.timeZone\\\", digitalData) || \\\"\\\",\\n        sotV246: safelyReadProperty(\\\"page?.attributes?.date?.timeZoneName\\\", digitalData) || \\\"\\\",\\n        sotV302: _satellite.readCookie(\\\"ttclid\\\") || \\\"\\\",\\n        sotV303: _satellite.readCookie(\\\"_ttp\\\") || \\\"\\\",\\n        sotV324: new URL(window.location.href).searchParams.get(\\\"gclid\\\") || \\\"\\\",\\n        sotV325: epikId,\\n        sotV278: _satellite.readCookie(\\\"referrer\\\") || \\\"\\\",\\n        sotV295: sc_click_id,\\n        sotV327: _satellite.getVar(\\\"[SOT] :: Forter Token\\\") || \\\"\\\",\\n        sotV341: _satellite.getVar(\\\"[SOT] :: URL Navigation History\\\") || \\\"\\\",\\n        sotV349: utm_id,\\n        sotV350: utm_source,\\n        sotV351: utm_medium,\\n        sotV352: utm_campaign,\\n        sotV353: utm_source_platform,\\n        sotV354: utm_term,\\n        sotV355: utm_content,\\n        sotV356: utm_creative_format,\\n        sotV357: utm_marketing_tactic,\\n        sotV361: sessionStorage.getItem('rdt_cid'),\\n        sotV362: _satellite.readCookie('_rdt_uuid') || \\\"\\\",\\n        sotV399: _satellite.getVar(\\\"[SOT] Page :: event_date_PST\\\")\\n      },\\n    };\\n\\n    if (allowTracking) {\\n      let additionalDataToSend = {\\n        sysInfo: {\\n          userLanguage: languageLocale,\\n          ipAddress: ipAddress || _satellite.getVar(\\\"[TMS] System Var - IP\\\"),\\n        },\\n        pageInfo: {\\n          title: pageTitle,\\n        },\\n        sotVars: {\\n          //Event Info\\n          sotV04: getSkuId(productSkuIdId),\\n          sotV05: getItemQty(productSkuIdId),\\n          sotV06: skuPrice,\\n          sotV07: skuBrand,\\n          sotV08: categoryId,\\n          sotV277: ipAddress\\n        },\\n        session: {\\n          biId: biAccountId,\\n          biTier: biStatus,\\n          biPoints: biPoints,\\n          profileId: profileId,\\n          platform: platform,\\n          emailId: emailId,\\n          signInState: signInStatus,\\n          timestamp: timestamp,\\n          atgId: _satellite.getVar(\\n            \\\"[TMS] Async :: User :: ATG ID - page load or async page load\\\"\\n          ),\\n        },\\n        sotProps: {\\n          sot20: timestamp + \\\"\\\",\\n        },\\n        eventTime: timestamp,\\n        eventId:\\n          _satellite.getVar(\\\"[UEID] :: Universal Event ID Fx\\\")(event) ||\\n          _satellite.getVar(\\\"[TMS] :: Event Id\\\"),\\n      };\\n\\n      if (linkName \\u0026\\u0026 linkName.toLowerCase() === \\\"add to loves\\\") {\\n        //SA-1172, SA-1998\\n        let dataEventDetail = getEventDetail(\\\"data\\\");\\n        if (dataEventDetail) {\\n          let keyValues = [\\n            \\\"skuId\\\",\\\"brandId\\\",\\\"productId\\\",\\\"productName\\\",\\\"preferredStoreId\\\",\\\"preferredZipCode\\\",\\\"listPrice\\\",\\\"brandName\\\",\\\"categoryName\\\",\\\"currency\\\",\\n            \\\"quantity\\\",\\\"qty\\\",\\\"skuVariationType\\\",\\\"skuVariationValue\\\",\\\"variationType\\\",\\\"variationValue\\\",\\\"isNew\\\",\\\"isOutOfStock\\\",\\\"totalBasketCount\\\", \\\"lovedSkusList\\\"\\n          ];\\n          let data = getValuesFromResponse(dataEventDetail, keyValues);\\n          const parentCategory = dataEventDetail?.item?.[0]?.sku?.parentCategory || \\\"\\\";\\n          let sotV04 = data.skuId || getSkuId(productSkuIdId) || \\\"\\\";\\n          let sotV05 = data.quantity || data.qty || \\\"1\\\";\\n          let sotV06 = data.listPrice || \\\"\\\";\\n          let sotV07 = data.brandName || \\\"\\\";\\n          let sotV08 = getParentCategoryFromSkuList(parentCategory, \\\"categoryId\\\") || digitalData?.product?.[0]?.attributes?.parentCategory?.categoryId || \\\"\\\";\\n          let sotV09 = data.currency ? data.currency : getCurrency() || \\\"\\\";\\n          let sotV15 = data.productId || \\\"\\\";\\n          let sotV174 = data.brandId || \\\"\\\";\\n          let sotV187 = data.preferredZipCode || \\\"\\\";\\n          let sotV192 = data.categoryName || getParentCategoryFromSkuList(parentCategory, \\\"displayName\\\") || _satellite.getVar(\\\"[TMS] Link :: Page World\\\") || pageTypeDetail;\\n          let sotV193 = data.preferredStoreId || \\\"\\\";\\n          let sotV215 = data.productName || getProductNameByProductId(data.productId) || \\\"\\\";\\n          let sotV216 = data.skuVariationType || data.variationType || \\\"\\\";\\n          let sotV217 = data.skuVariationValue || data.variationValue || \\\"\\\";\\n          let sotV288 = data.isNew ? \\\"Yes\\\" : \\\"No\\\";\\n          let sotV289 = data.totalBasketCount || 0;\\n          let sotV290 = data.isOutOfStock ? \\\"Yes\\\" : \\\"No\\\";\\n          let sotV259 = getWishListSkuIds() || data.lovedSkusList || \\\"\\\";\\n          additionalDataToSend.sotVars = {\\n            sotV04,\\n            sotV05,\\n            sotV06,\\n            sotV07,\\n            sotV08,\\n            sotV09,\\n            sotV15,\\n            sotV174,\\n            sotV187,\\n            sotV192,\\n            sotV193,\\n            sotV215,\\n            sotV216,\\n            sotV217,\\n            sotV259,\\n            sotV288,\\n            sotV289,\\n            sotV290,\\n          };\\n        }\\n      }\\n\\n      //SA-1167, //SA-2135, XSEL-4244\\n      if (linkName === \\\"Add To Basket\\\" || sampleBasket) {\\n        let dataEventDetail = getEventDetail(\\\"data\\\");\\n        linkName = \\\"Add To Basket\\\";\\n        if (dataEventDetail) {\\n          let keyValues = [\\\"zipCode\\\",\\\"storeId\\\", \\\"threshold\\\",\\\"totalBasketCount\\\",\\\"isAppExclusive\\\",\\\"isLimitedEdition\\\",\\\"skuId\\\",\\\"productId\\\",\\\"productName\\\",\\n            \\\"listPrice\\\",\\\"biType\\\",\\\"isOnlineOnly\\\",\\\"isSameDayDeliveryEligible\\\",\\\"isPickUpEligibleSku\\\",\\\"brandName\\\",\\\"category\\\",\\\"topCategory\\\",\\n            \\\"categoryName\\\",\\\"currency\\\",\\\"quantity\\\",\\\"qty\\\",\\\"skuVariationType\\\",\\\"skuVariationValue\\\",\\\"variationType\\\",\\\"variationValue\\\", \\\"changedQuantity\\\"];\\n          let data = getValuesFromResponse(dataEventDetail, keyValues);\\n          const parentCategory = dataEventDetail?.sku?.parentCategory;\\n          let preferredZipCode = getDataFromSessionStorage(\\\"preferredZipCode\\\");\\n          let storeId = getDataFromSessionStorage(\\\"selectedStore\\\");\\n          let sotV04 = data.skuId || getSkuId(productSkuIdId) || \\\"\\\";\\n          let sotV05 = data.changedQuantity || data.quantity || data.qty || \\\"1\\\";\\n          let sotV06 = data.listPrice || data.biType || \\\"\\\";\\n          let sotV07 = data.brandName || dataEventDetail?.sku?.brandName || \\\"\\\";\\n          let sotV08 = getParentCategoryFromSkuList(parentCategory, \\\"categoryId\\\") || categoryIdBasketCache || \\\"\\\";\\n          let sotV09 = data.currency || getCurrency() || \\\"\\\";\\n          let sotV15 = data.productId || \\\"\\\";\\n          let sotV63 = getBasketType(sotV04) || shippingMethod === \\\"bopis\\\" ? \\\"buy online and pick up\\\" : shippingMethod || \\\"\\\";\\n          let sotV187 = preferredZipCode?.data?.preferredZipCode \\u0026\\u0026 sotV63 === \\\"same day delivery\\\" ? preferredZipCode.data.preferredZipCode : data.zipCode !== \\\"n/a\\\" \\u0026\\u0026 data.zipCode !== null ? data.zipCode : \\\"\\\";\\n          let sotV188 = data.isOnlineOnly || (digitalData?.product?.[0]?.productInfo?.isOnlineOnly) ? \\\"Yes\\\" : \\\"No\\\";\\n          let sotV189 = data.isSameDayDeliveryEligible || safelyReadProperty(\\\"page.attributes.isSameDayDeliveryAvailable\\\", digitalData) ? \\\"Yes\\\" : \\\"No\\\";\\n          let sotV190 = data.isPickUpEligibleSku || safelyReadProperty(\\\"page.attributes.isAvailablePreferredStore\\\", digitalData)  ? \\\"Yes\\\" : \\\"No\\\";\\n          let category = data.category || data.topCategory || data.categoryName || getParentCategoryFromDigitalData(sotV04) || pageWorld;\\n          let sotV192 = digitalData?.page?.pageInfo?.pageName === \\\"rewards bazaar\\\" ? \\\"Reward\\\" : category ? category : \\\"\\\";\\n          let sotV193 = storeId?.data?.storeId \\u0026\\u0026 sotV63 === \\\"buy online and pick up\\\" ? storeId.data.storeId : data.storeId !== \\\"n/a\\\" \\u0026\\u0026 data.storeId !== null ? data.storeId : \\\"\\\";\\n          let sotV211 = data.isAppExclusive ? \\\"Yes\\\" : \\\"No\\\";\\n          let sotV215 = data.productName || \\\"\\\";\\n          let sotV216 = data.skuVariationType || data.variationType || \\\"\\\";\\n          let sotV217 = data.skuVariationValue || data.variationValue || \\\"\\\";\\n          let sotV277 = ipAddress;\\n          let sotV289 = data.totalBasketCount || 0;\\n          let sotV291 = data.isLimitedEdition ? \\\"Yes\\\" : \\\"No\\\";\\n          let sotV300 = data.biType || \\\"\\\";\\n          let sotV301 = data.threshold || \\\"n/a\\\";\\n          let sotV326 = getShippingWithSkuIDs() || \\\"\\\";\\n          let sotV254 = cartSkuIds;\\n\\n          let omPrice = data?.listPrice;\\n          let sotV11;\\n          if (omPrice) {\\n            omPrice = omPrice.replace(',', '.');\\n            omPrice = omPrice.replace('$', '');\\n            omPrice = omPrice.trim();\\n            omPrice = Sephora.analytics.utils.convertToUSD(omPrice);\\n            sotV11 = (!isNaN(omPrice) \\u0026\\u0026 !isNaN(sotV05) \\u0026\\u0026 (omPrice * sotV05)) || \\\"\\\";\\n          }\\n          additionalDataToSend.sotVars = {\\n            sotV04,\\n            sotV05,\\n            sotV06,\\n            sotV07,\\n            sotV08,\\n            sotV09,\\n            sotV11,\\n            sotV15,\\n            sotV63,\\n            sotV187,\\n            sotV188,\\n            sotV189,\\n            sotV190,\\n            sotV192,\\n            sotV193,\\n            sotV211,\\n            sotV215,\\n            sotV216,\\n            sotV217,\\n            sotV254,\\n            sotV277,\\n            sotV289,\\n            sotV291,\\n            sotV300,\\n            sotV301,\\n            sotV326,\\n            sotV365,\\n            sotV366\\n          };\\n        }\\n      }\\n\\n      var finalPayload = mergeObjects(dataToSend, additionalDataToSend);\\n      const isValidLinkName = getValidLinkName(linkName);\\n      if (isValidLinkName) {\\n        (window.sephoraOneTag_cmds = window.sephoraOneTag_cmds || []).push([\\n          \\\"trackEvent\\\",\\n          formatSotType(linkName),\\n          finalPayload,\\n        ]);\\n      }\\n    } else {\\n      // DPS-1387, DPS-1629, DPS-1646\\n      let allowedLinkActionInfo = [\\n        \\\"un-love\\\",\\n        \\\"view items and checkout:shipped\\\",\\n        \\\"view items and checkout:bopis\\\",\\n        \\\"review:read more\\\",\\n        \\\"Question Answer Helpfulness\\\",\\n        \\\"questions\\u0026answers:sort selection\\\",\\n        \\\"Question Answer Sort\\\",\\n        \\\"questions and answers:show more\\\",\\n        \\\"proactive customer chat:displayed\\\",\\n        \\\"active customer chat:resume session\\\",\\n        \\\"reactive customer chat:start session\\\",\\n        \\\"reactive customer chat:end session\\\",\\n        \\\"order cancellation:request\\\",\\n        \\\"cmnty:joingroup\\\",\\n        \\\"cmnty:leavegroup\\\",\\n        \\\"cmnty:signup\\\",\\n        \\\"product:alt-image:zoom\\\",\\n        \\\"happening:use my location\\\",\\n        \\\"happening:enter my location\\\",\\n        \\\"creditcard:submit application\\\",\\n        \\\"order cancellation:success\\\",\\n        \\\"order cancellation:decline\\\",\\n        \\\"address verification:use recommended address:drop-down\\\",\\n        \\\"address verification:use recommended address\\\",\\n        \\\"address verification:use entered address\\\",\\n        \\\"cmnty:gallery:product-tagged\\\",\\n        \\\"cmnty:love:conversation\\\",\\n        \\\"reviews:ratings and reviews-filter\\\",\\n        \\\"reviews:ratings and reviews:search\\\",\\n        \\\"checkout:payment:klarna\\\",\\n        \\\"checkout:payment:venmo\\\",\\n        \\\"checkout:payment:paze\\\",\\n        \\\"Review Helpfulness\\\",\\n        \\\"video popup\\\",\\n        \\\"Video Progress\\\",\\n        \\\"Custom Set Add To Set\\\",\\n        \\\"Custom Set Remove From Set\\\",\\n        \\\"Custom Set Items View More\\\",\\n        \\\"checkout:payment:continue with klarna\\\",\\n        \\\"checkout:payment:continue with paze\\\",\\n        \\\"alternate pickup person:submit\\\",\\n        \\\"alternate pickup person:removed\\\",\\n        \\\"order confirmation:continue shopping\\\",\\n        \\\"page view\\\",\\n        \\\"Question And Answer Helpfulness\\\",\\n        \\\"checkout shipping method update\\\"\\n      ];\\n\\n      let set9Events = [\\n        \\\"user profile:my account:email:edit\\\",\\n        \\\"user profile:my account:name:edit\\\",\\n        \\\"user profile:my account:password:edit\\\",\\n        \\\"happening at sephora:appointment type-filter\\\",\\n        \\\"profile:bi-traits:private\\\",\\n        \\\"cmnty:my profile:edit\\\",\\n        \\\"product:alt-image:scroll:next\\\",\\n        \\\"product:alt-image:swatch:size\\\",\\n        \\\"Shop All From This Brand\\\",\\n        \\\"Write A Review\\\",\\n      ];\\n\\n      let set14OnwardsEvents = [\\n        // Set 14 events\\n        \\\"proactive customer chat:start session\\\",\\n        \\\"proactive customer chat:end session\\\",\\n        \\\"customer chat:unavailable\\\",\\n        \\\"Chat Page View\\\",\\n        // Set 15 events\\n        \\\"See All Reviews\\\",\\n        \\\"user profile my account name update\\\",\\n        \\\"user profile my account password update\\\",\\n        // Set 17 events\\n        \\\"product fulfilment option selected\\\",\\n        \\\"bopis store selected\\\",\\n        \\\"productfinder start quiz\\\",\\n        \\\"mega filter show results click\\\",\\n        \\\"profile bi traits private\\\",\\n        \\\"replacement order submit for review click\\\",\\n        \\\"checkout:payment:afterpay\\\",\\n        \\\"checkout:payment:paypal\\\",\\n        \\\"checkout:payment:continue with afterpay\\\",\\n        \\\"same day delivery:time selection modal close\\\",\\n        \\\"same day delivery:time selection confirm\\\",\\n        \\\"same-day unlimited:zip code unavailable\\\",\\n        \\\"same day unlimited cancel trial confirmation\\\",\\n        \\\"same day unlimited cancel subscription confirmation\\\",\\n      ];\\n\\n      let rmnEvents = [\\n        \\\"pla_sponsored_product_click\\\",\\n        \\\"pla sponsored product click\\\",\\n      ];\\n      let rmnImpressionEvents = [\\n        \\\"pla_sponsored_product_viewable_impression\\\",\\n        \\\"pla sponsored product viewable impression\\\",\\n      ];\\n      let rmnBannerEvents = [\\n        \\\"pla_sponsored_banner_click\\\",\\n        \\\"pla sponsored banner click\\\",\\n        \\\"pla_sponsored_banner_viewable_impression\\\",\\n        \\\"pla sponsored banner viewable impression\\\",\\n      ];\\n      let rmnCarouselEvents = [\\n        \\\"carousel_product_click\\\",\\n        \\\"pla_sponsored_carousel_click\\\",\\n        \\\"carousel_product_view\\\",\\n      ];\\n      let autoReplenishEvents = [\\n        \\\"auto replenish unsubscribe subscription confirmation\\\",\\n        \\\"auto replenish manage subscription close\\\",\\n        \\\"auto replenish pause subscription close\\\",\\n        \\\"auto replenish get it sooner subscription close\\\",\\n        \\\"auto replenish get it sooner subscription confirmation\\\",\\n      ];\\n      let askQuesAnsEvents = [\\\"submit this answer\\\", \\\"submit a question\\\"];\\n      let bbqPromo = [\\n        \\\"BBQ Qualified\\\",\\n        \\\"BBQ not qualified\\\",\\n        \\\"BBQ Qualified enter promo code\\\",\\n        \\\"BBQ qualified not signed in\\\",\\n        \\\"BBQ qualified not BI\\\",\\n      ];\\n      let bbqEnabled = false;\\n      //SA-1211, SA-1212, SA-1213\\n      let beautyPreferenceMileStone = [\\n        \\\"mysephora:completion milestone 0\\\",\\n        \\\"mysephora:completion milestone 1\\\",\\n        \\\"mysephora:completion milestone 2\\\",\\n      ];\\n\\n      //SA-1325, SA-1471, SA-1472\\n      let productNotifications = [\\n        \\\"coming soon notification\\\",\\n        \\\"out of stock notification\\\",\\n        \\\"unsubscribe coming soon notification\\\",\\n        \\\"unsubscribe out of stock notification\\\",\\n      ];\\n\\n      let removeFromBasketEvents = [\\n        \\\"remove from basket\\\",\\n        \\\"basket:delete\\\",\\n        \\\"Remove From Basket\\\",\\n        \\\"reward bazaar:remove from basket\\\",\\n        \\\"Remove samples from Basket\\\",\\n        \\\"basket:edit quantity:decrease\\\",\\n      ];\\n\\n      let beautyOffersPromos = [\\n        \\\"Enter Promo Code\\\",\\n        \\\"remove promo code\\\",\\n        \\\"Remove Promo Code\\\",\\n      ];\\n      \\n      let birthdayGiftMessage = [\\n        \\\"gift message image select\\\",\\n        \\\"checkout gift message submit success\\\"\\n      ];\\n      \\n      let sharableListEvents = [\\n        \\\"shareable list sku addition success\\\",\\n        \\\"create new shareable list click\\\",\\n        \\\"shareable list pop up displayed\\\",\\n        \\\"shareable list created\\\",\\n        \\\"shareable list edit clicked\\\"\\n      ];\\n\\n      allowedLinkActionInfo = allowedLinkActionInfo.concat(\\n        set9Events,\\n        rmnEvents,\\n        rmnImpressionEvents,\\n        rmnBannerEvents,\\n        rmnCarouselEvents,\\n        set14OnwardsEvents,\\n        autoReplenishEvents,\\n        bbqPromo,\\n        beautyPreferenceMileStone,\\n        removeFromBasketEvents,\\n        beautyOffersPromos,\\n        birthdayGiftMessage,\\n        sharableListEvents\\n      );\\n\\n      // For Adobe Link Page Tracking Events\\n      linkName = _satellite.getVar(\\\"[TMS] Link :: Action Info\\\");\\n      let additionalDataPayload = {\\n        sysInfo: {\\n          userLanguage: languageLocale,\\n          ipAddress: ipAddress || _satellite.getVar(\\\"[TMS] System Var - IP\\\"),\\n        },\\n        pageInfo: {\\n          title: pageTitle,\\n        },\\n        session: {\\n          profileId: profileId,\\n          platform: platform,\\n          emailId: emailId,\\n          signInState: signInStatus,\\n          timestamp: timestamp,\\n          atgId: _satellite.getVar(\\n            \\\"[TMS] Async :: User :: ATG ID - page load or async page load\\\"\\n          ),\\n        },\\n        sotProps: {\\n          sot20: timestamp + \\\"\\\",\\n        },\\n        sotVars: {\\n          sotV04: getEventDetail(\\\"data.sku.skuId\\\") || digitalData?.cart?.attributes?.skuIds[0],\\n        },\\n        eventTime: timestamp,\\n        eventId:\\n          _satellite.getVar(\\\"[UEID] :: Universal Event ID Fx\\\")(event) ||\\n          _satellite.getVar(\\\"[TMS] :: Event Id\\\"),\\n      };\\n\\n      let sotV14 = safelyReadProperty(\\\"sotVars.sotV14\\\", dataToSend);\\n      let isBasketSwitch = linkName \\u0026\\u0026 linkName.indexOf(\\\"change method\\\") != -1;\\n      let isSwatchClick = getEventDetail(\\\"data.specificEventName\\\") === \\\"swatch_click\\\";\\n      let isLoginError = sotV14.indexOf(\\\"event140,event141\\\") != -1;\\n      let isDeviceExistError = checkTheErrorMessage();\\n      let isReviewNullSearch = sotV14.indexOf(\\\"event81\\\") != -1;\\n      let videoProgressPercentage =\\n        (sotV14.indexOf(\\\"event103\\\") != -1 \\u0026\\u0026 25) ||\\n        (sotV14.indexOf(\\\"event104\\\") != -1 \\u0026\\u0026 50) ||\\n        (sotV14.indexOf(\\\"event105\\\") != -1 \\u0026\\u0026 75) ||\\n        (sotV14.indexOf(\\\"event106\\\") != -1 \\u0026\\u0026 100);\\n      let isChatPageView = sotV14.indexOf(\\\"event220\\\") != -1;\\n\\n      let url_string = window.location.href;\\n      let url = new URL(url_string);\\n      let productId = url.searchParams.get(\\\"productId\\\");\\n      let questionId = url.searchParams.get(\\\"questionId\\\");\\n      let askQuesAns = false;\\n      let sotV236;\\n      if (isBasketSwitch) {\\n        linkName = \\\"Item Basket Switch\\\";\\n      } else if (isSwatchClick) {\\n        linkName = \\\"product altimage swatch click\\\";\\n        additionalDataPayload.sotVars.sotV04 = safelyReadProperty(\\\"data.sku.skuId\\\",event.detail);\\n        sotV236 = safelyReadProperty(\\\"data.sku.isOutOfStock\\\", event.detail) ? \\\"N/a\\\" : safelyReadProperty(\\\"data.sku.isOnlyFewLeft\\\", event.detail) ? \\\"Yes\\\" : \\\"No\\\";\\n        additionalDataPayload.sotVars.sotV236 = sotV236;\\n      } else if (isLoginError || isDeviceExistError) {\\n        linkName = \\\"Login Error\\\";\\n      } else if (isReviewNullSearch) {\\n        linkName = \\\"Review Null Search\\\";\\n      } else if (linkName === \\\"happening at sephora:appointment type-filter\\\") {\\n        additionalDataPayload.sotVars.sotV23 = getEventAttribute(\\n          \\\"eventInfo.attributes.selectedFilter\\\"\\n        );\\n      } else if (linkName === \\\"product:alt-image:scroll:next\\\") {\\n        additionalDataPayload.sotVars.sotV173 = getEventAttribute(\\n          \\\"eventInfo.attributes.imageIndex\\\"\\n        );\\n        additionalDataPayload.sotVars.sotV04 = safelyReadProperty(\\\"data.sku.skuId\\\",event.detail);\\n      } else if (videoProgressPercentage) {\\n        linkName = \\\"Video Progress\\\";\\n        additionalDataPayload.sotVars.sotV176 = videoProgressPercentage;\\n      } else if (linkName.indexOf(\\\"product:alt-image:swatch:size\\\") !== -1) {\\n        additionalDataPayload.sotVars.sotV04 = safelyReadProperty(\\\"data.sku.skuId\\\", event.detail);\\n        sotV236 = safelyReadProperty(\\\"data.sku.isOutOfStock\\\", event.detail) ? \\\"N/a\\\" : safelyReadProperty(\\\"data.sku.isOnlyFewLeft\\\", event.detail) ? \\\"Yes\\\" : \\\"No\\\";\\n        additionalDataPayload.sotVars.sotV236 = sotV236;\\n      } else if (rmnEvents.indexOf(linkName) \\u003e -1) {\\n        linkName = \\\"pla sponsored product click\\\";\\n        let sponsoredProducts = getEventDetail(\\n          \\\"data.sponsoredProductInformation\\\"\\n        );\\n        if (sponsoredProducts \\u0026\\u0026 sponsoredProducts.isSponsoredProduct) {\\n          additionalDataPayload.sotVars.sotV191 =\\n            sponsoredProducts.clickTrackerId +\\n            \\\";\\\" +\\n            sponsoredProducts.clickPayload;\\n        }\\n      } else if (rmnImpressionEvents.indexOf(linkName) \\u003e -1) {\\n        linkName = \\\"pla sponsored product viewable impression\\\";\\n        let sponsoredProducts = getEventDetail(\\n          \\\"data.sponsoredProductInformation\\\"\\n        );\\n        if (sponsoredProducts \\u0026\\u0026 sponsoredProducts.isSponsoredProduct) {\\n          additionalDataPayload.sotVars.sotV200 =\\n            sponsoredProducts.impressionTrackerId +\\n            \\\";\\\" +\\n            sponsoredProducts.impressionPayload;\\n        }\\n      } else if (rmnBannerEvents.indexOf(linkName) \\u003e -1) {\\n        linkName = linkName.replace(/_/g, \\\" \\\");\\n        let sponsoredProducts = getEventDetail(\\n          \\\"data.sponsoredProductInformation\\\"\\n        );\\n        let isImpression = linkName.indexOf(\\\"impression\\\") \\u003e -1 ? true : false;\\n        if (sponsoredProducts \\u0026\\u0026 sponsoredProducts.isSponsoredProduct) {\\n          if (isImpression) {\\n            additionalDataPayload.sotVars.sotV200 =\\n              sponsoredProducts.impressionTrackerId +\\n              \\\";\\\" +\\n              sponsoredProducts.impressionPayload;\\n          } else {\\n            additionalDataPayload.sotVars.sotV191 =\\n              sponsoredProducts.clickTrackerId +\\n              \\\";\\\" +\\n              sponsoredProducts.clickPayload;\\n          }\\n        }\\n      } else if (rmnCarouselEvents.indexOf(linkName) \\u003e -1) {\\n        linkName = linkName.replace(/_/g, \\\" \\\");\\n        let sponsoredProducts = getEventDetail(\\n          \\\"data.sponsoredProductInformation\\\"\\n        );\\n        if (sponsoredProducts) {\\n          additionalDataPayload.sotVars.sotV191 =\\n            sponsoredProducts.clickTrackerId +\\n            \\\";\\\" +\\n            sponsoredProducts.clickPayload +\\n            \\\";\\\" +\\n            sponsoredProducts.impressionTrackerId;\\n        }\\n      }\\n\\n      //SA-1175\\n      if (isBasketSwitch) {\\n        const dataEventDetail = getEventDetail(\\\"data\\\");\\n        const {\\n          sku: {\\n            skuId = \\\"\\\",\\n            brandName = \\\"\\\",\\n            productId,\\n            productName = \\\"\\\",\\n            variationType = \\\"\\\",\\n            variationValue = \\\"\\\"\\n          } = {}\\n        } = dataEventDetail || {};\\n\\n        const { previousMethod, changedMethod } = getShippingMethodFromLinkName(dataEventDetail?.linkName);\\n        const previousDeliveryMethod = previousMethod || getEventAttribute(\\\"eventInfo.attributes.previousDeliveryMethod\\\") || getEventAttribute(\\\"eventInfo.attributes.pageDetail\\\");\\n\\n        additionalDataPayload.sotVars = {\\n          sotV04: skuId || digitalData?.cart?.attributes?.skuIds[0] || \\\"\\\",\\n          sotV07: brandName,\\n          sotV15: productId || getProductIdforSotV15(eventProductId, eventPageDetail),\\n          sotV153: previousDeliveryMethod || \\\"\\\",\\n          sotV154: changedMethod || \\\"\\\",\\n          sotV215: productName,\\n          sotV216: variationType,\\n          sotV217: variationValue,\\n        };\\n      }\\n\\n      if (linkName === \\\"questions\\u0026answers:sort selection\\\") {\\n        linkName = \\\"Question Answer Sort\\\";\\n        let filterString = getEventAttribute(\\\"eventInfo.attributes.selectedFilter\\\");\\n        productId = productId || getEventAttribute(\\\"eventInfo.attributes.pageDetail\\\");\\n        additionalDataPayload.sotVars = {\\n          sotV13: ccpaConsentCookie,\\n          sotV84: filterString,\\n          sotV15: productId,\\n        };\\n      }\\n\\n      if (linkName === \\\"Question Answer Helpfulness\\\") {\\n        let questionId = getEventAttribute(\\\"eventInfo.attributes.questionId\\\");\\n        let answerId = getEventAttribute(\\\"eventInfo.attributes.answerId\\\");\\n        let helpfulness = getEventAttribute(\\\"eventInfo.attributes.helpfulness\\\");\\n\\n        additionalDataPayload.sotVars = {\\n          sotV13: ccpaConsentCookie,\\n          sotV166: questionId,\\n          sotV167: answerId,\\n          sotV160: helpfulness,\\n        };\\n      }\\n\\n      if (linkName === \\\"review:read more\\\") {\\n        let reviewId = getEventAttribute(\\\"eventInfo.attributes.reviewId\\\");\\n        productId = productId || getEventAttribute(\\\"eventInfo.attributes.pageDetail\\\");\\n        //SA-809\\n        let {\\n          listPrice,\\n          brandName,\\n          productName,\\n          categoryName,\\n          skuVariationType,\\n          skuVariationValue,\\n          skuId,\\n          currency,\\n        } = getEventDetail(\\\"data\\\");\\n        additionalDataPayload.sotVars = {\\n          sotV13: ccpaConsentCookie,\\n          sotV165: reviewId,\\n          sotV15: productId || \\\"\\\",\\n          sotV04: skuId,\\n          sotV192: categoryName || getEventAttribute(\\\"eventInfo.attributes.categoryName\\\"),\\n          sotV05: getItemQty(skuId),\\n          sotV06: listPrice || getEventAttribute(\\\"eventInfo.attributes.listPrice\\\"),\\n          sotV09: currency || \\\"\\\",\\n          sotV07: brandName || getEventAttribute(\\\"eventInfo.attributes.brandName\\\"),\\n          sotV215: productName || \\\"\\\",\\n          sotV216: skuVariationType || \\\"\\\",\\n          sotV217: skuVariationValue || \\\"\\\",\\n        };\\n      }\\n\\n      if (linkName === \\\"un-love\\\") {\\n        //SA-810 //SA-1173, SA-1359, XSEL-4249\\n        let dataEventDetail = getEventDetail(\\\"data\\\");\\n        let keyValues = [\\n          \\\"world\\\",\\\"currency\\\",\\\"isNew\\\",\\\"isOutOfStock\\\",\\\"preferredZipCode\\\",\\\"preferredStoreId\\\",\\\"totalBasketCount\\\",\\\"type\\\",\\\"skuId\\\",\\\"brandId\\\",\\\"productId\\\",\\\"productName\\\",\\n          \\\"listPrice\\\",\\\"biType\\\",\\\"brandName\\\",\\\"categoryName\\\",\\\"quantity\\\",\\\"qty\\\",\\\"skuVariationType\\\",\\\"skuVariationValue\\\",\\\"variationType\\\",\\\"variationValue\\\",\\\"fullSiteProductUrl\\\", \\\"lovedSkusList\\\"];\\n        let data = getValuesFromResponse(dataEventDetail, keyValues);\\n        let sotV259 = getWishListSkuIds() || data.lovedSkusList || \\\"\\\";\\n        additionalDataPayload.sotVars = {\\n          sotV13: ccpaConsentCookie,\\n          sotV15: data.productId || getEventAttribute(\\\"eventInfo.attributes.pageDetail\\\") || \\\"\\\",\\n          sotV04: data.skuId || \\\"\\\",\\n          sotV05: data.quantity || getItemQty(data.skuId) || 1,\\n          sotV06: data.listPrice || data.biType || getEventAttribute(\\\"eventInfo.attributes.listPrice\\\") || \\\"\\\",\\n          sotV09: data.currency || \\\"\\\",\\n          sotV07: data.brandName || getEventAttribute(\\\"eventInfo.attributes.brandName\\\") || \\\"\\\",\\n          sotV187: data.preferredZipCode || \\\"\\\",\\n          sotV192: data.categoryName || data.world || getEventAttribute(\\\"eventInfo.attributes.categoryName\\\") || \\\"n/a\\\",\\n          sotV193: data.preferredStoreId || \\\"\\\",\\n          sotV215: data.productName || getProductName() || \\\"\\\",\\n          sotV216: data.skuVariationType || \\\"\\\",\\n          sotV217: data.skuVariationValue || \\\"\\\",\\n          sotV259,\\n          sotV288: data.isNew ? \\\"Yes\\\" : \\\"No\\\",\\n          sotV289: data.totalBasketCount || 0,\\n          sotV290: data.isOutOfStock ? \\\"Yes\\\" : \\\"No\\\",\\n        };\\n      }\\n\\n      if (linkName === \\\"reviews:ratings\\u0026reviews-filter\\\") {\\n        linkName = \\\"reviews:ratings and reviews-filter\\\";\\n        let filterString = getEventAttribute(\\\"eventInfo.attributes.selectedFilter\\\");\\n        additionalDataPayload.sotVars = {\\n          sotV13: ccpaConsentCookie,\\n          sotV84: filterString,\\n        };\\n      }\\n\\n      if (linkName === \\\"review:helpful\\\" || linkName === \\\"review:unhelpful\\\") {\\n        let reviewId = getEventAttribute(\\\"eventInfo.attributes.reviewId\\\");\\n        linkName = \\\"Review Helpfulness\\\";\\n        additionalDataPayload.sotVars = {\\n          sotV13: ccpaConsentCookie,\\n          sotV160: actionInfo,\\n          sotV165: reviewId,\\n        };\\n      }\\n      \\n      //SA-3007\\n       if (getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.actionInfo\\\") === \\\"question and answer:helpful\\\") {\\n        let reviewId = getEventDetail(\\\"data.reviewId\\\") ? getEventDetail(\\\"data.reviewId\\\") : \\\"\\\";\\n        linkName = \\\"Question And Answer Helpfulness\\\";\\n        additionalDataPayload.sotVars = {\\n          sotV13: ccpaConsentCookie,\\n          sotV160: getEventDetail(\\\"data.actionInfo\\\") || actionInfo || \\\"\\\",\\n          sotV165: reviewId,\\n        };\\n      }\\n\\n      if (linkName === \\\"reviews:ratings\\u0026reviews:search\\\" || isReviewNullSearch) {\\n        linkName = linkName === \\\"reviews:ratings\\u0026reviews:search\\\" ? \\\"reviews:ratings and reviews:search\\\" : linkName;\\n        additionalDataPayload.sotVars = {\\n          sotV15: getEventAttribute(\\\"eventInfo.attributes.pageDetail\\\"),\\n        };\\n      }\\n\\n      //SA-1174, SA-2134,XSEL-4246\\n      if ((getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.linkName\\\")?.toLowerCase() === \\\"remove from basket\\\") || removeFromBasketEvents.includes(linkName) || checkRemoveFromBasketEvents(linkName, removeFromBasketEvents)) {\\n        linkName = \\\"remove from basket\\\";\\n        let dataEventDetail = getEventDetail(\\\"data\\\");\\n        let keyValues = [\\n          \\\"threshold\\\", \\\"world\\\", \\\"totalBasketCount\\\",\\\"type\\\",\\\"skuId\\\",\\\"brandId\\\",\\\"productId\\\",\\\"productName\\\",\\\"listPrice\\\",\\\"biType\\\",\\\"brandName\\\",\\n          \\\"categoryName\\\",\\\"quantity\\\",\\\"qty\\\",\\\"skuVariationType\\\",\\\"skuVariationValue\\\",\\\"variationType\\\",\\\"variationValue\\\",\\\"fullSiteProductUrl\\\",\\\"changedQuantity\\\"\\n        ];\\n        let data = getValuesFromResponse(dataEventDetail, keyValues);\\n        const parentCategory = dataEventDetail?.sku?.parentCategory;\\n        let sotV04 = data.skuId || \\\"\\\";\\n        let sotV05 = data.changedQuantity || data.quantity || data.qty || getItemQty(event?.detail?.data?.sku?.skuId, true) || 1;\\n        let sotV06 = data.listPrice || data.biType || data.type === \\\"sample\\\" ? \\\"FREE\\\" : \\\"\\\";\\n        let sotV07 = data.brandName || \\\"\\\";\\n        let sotV08 = getParentCategoryFromSkuList(parentCategory, \\\"categoryId\\\") || categoryIdBasketCache || \\\"\\\";\\n        let sotV09 = data.currency || getCurrency() || \\\"\\\";\\n        let sotV15 = data.productId || getProductIdforSotV15(eventProductId, eventPageDetail) || \\\"\\\";\\n        let sotV153 = getBasketType(sotV04) || dataEventDetail.shippingMethod ? dataEventDetail.shippingMethod.toLowerCase() : data.type ? data.type.toLowerCase() : \\\"\\\";\\n        let sotV174 = data.brandId ? data.brandId : \\\"\\\";\\n        let sotV181 = data.fullSiteProductUrl ? data.fullSiteProductUrl : \\\"\\\";\\n        let category = data.categoryName || getParentCategoryFromSkuList(parentCategory, \\\"displayName\\\") || getParentCategoryFromDigitalData(sotV04) || sotSubCategory;\\n        let sotV192 = digitalData?.page?.pageInfo?.pageName === \\\"rewards bazaar\\\" ? \\\"Reward\\\" : category ? category : \\\"\\\";\\n        let sotV215 = data.productName || \\\"\\\";\\n        let sotV216 = data.variationType || \\\"\\\";\\n        let sotV217 = data.variationValue || \\\"\\\";\\n        let sotV289 = data.totalBasketCount || 0;\\n        let sotV254 = getBasketSkuIdsFromLocalStorage() || \\\"n/a\\\";\\n        let sotV300 = data.biType || \\\"\\\";\\n        let sotV301 = data.threshold || \\\"n/a\\\";\\n        let sotV326 = getShippingWithSkuIDs() || \\\"\\\";\\n        let sotV372 = dataEventDetail?.sku?.parentCategory?.categoryId || '';\\n        additionalDataPayload.sotVars = {\\n          sotV13: ccpaConsentCookie,\\n          sotV04,\\n          sotV05,\\n          sotV06,\\n          sotV07,\\n          sotV08,\\n          sotV09,\\n          sotV15,\\n          sotV153,\\n          sotV174,\\n          sotV181,\\n          sotV192,\\n          sotV215,\\n          sotV216,\\n          sotV217,\\n          sotV254,\\n          sotV289,\\n          sotV300,\\n          sotV301,\\n          sotV326,\\n          sotV365,\\n          sotV366,\\n          sotV372\\n        };\\n      }\\n\\n      if (getEventDetail(\\\"data.linkName\\\") === \\\"answer_question_body_details\\\") {\\n        linkName = \\\"submit this answer\\\";\\n        const previousPage = \\\"submit this answer\\\";\\n        const sponsoredProductInformation = getEventDetail(\\\"data.sponsoredProductInformation\\\") || {};\\n        askQuesAns = true;\\n        additionalDataPayload.sotVars = {\\n          sotSubType: sotSubType,\\n          sotSubCategory: sotSubCategory,\\n          sotV01: \\\"answer-submit\\\",\\n          sotV02: pageWorld,\\n          sotV15: productId,\\n          sotV166: questionId,\\n          sotV88: previousPage,\\n        };\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV186\\\",sponsoredProductInformation.answerQuestionText);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV214\\\",sponsoredProductInformation.answerBody);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV04\\\",sponsoredProductInformation.answerSkuId);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV15\\\",sponsoredProductInformation.answerProductId);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV192\\\",sponsoredProductInformation.answerProductTopCategory);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV06\\\",sponsoredProductInformation.answerPrice);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV09\\\",sponsoredProductInformation.answerCurrency);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV07\\\",sponsoredProductInformation.answerBrandName);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV215\\\",sponsoredProductInformation.answerProductName);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV216\\\",sponsoredProductInformation.answerVariationType);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV217\\\",sponsoredProductInformation.answerVariationValue);\\n      }\\n\\n      if (getEventDetail(\\\"data.linkName\\\") === \\\"ask_question_body_details\\\") {\\n        linkName = \\\"submit a question\\\";\\n        const previousPage = \\\"submit a question\\\";\\n        askQuesAns = true;\\n        const sponsoredProductInformation = getEventDetail(\\\"data.sponsoredProductInformation\\\") || {};\\n        additionalDataPayload.sotVars = {\\n          sotSubType: sotSubType,\\n          sotSubCategory: sotSubCategory,\\n          sotV01: \\\"question-submit\\\",\\n          sotV02: pageWorld,\\n          sotV15: productId,\\n          sotV88: previousPage,\\n        };\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV186\\\",sponsoredProductInformation.questionBody);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV04\\\",sponsoredProductInformation.questionSkuId);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV15\\\",sponsoredProductInformation.questionProductId);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV192\\\",sponsoredProductInformation.questionProductTopCategory);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV06\\\",sponsoredProductInformation.questionPrice);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV09\\\",sponsoredProductInformation.questionCurrency);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV07\\\",sponsoredProductInformation.questionBrandName);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV215\\\",sponsoredProductInformation.questionProductName);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV216\\\",sponsoredProductInformation.questionVariationType);\\n        setIfNotNull(additionalDataPayload.sotVars,\\\"sotV217\\\",sponsoredProductInformation.questionVariationValue);\\n      }\\n\\n      if (linkName === \\\"user profile:my account:name:update\\\") {\\n        linkName = \\\"page view\\\";\\n        additionalDataPayload.sotVars = {\\n          sotSubType: sotSubType,\\n          sotSubCategory: sotSubCategory,\\n          sotV01: pageTypeDetail,\\n          sotV02: pageWorld,\\n          sotV88: \\\"user profile my account name update\\\",\\n        };\\n      }\\n\\n      if (actionInfo === \\\"user profile:my account:password:update\\\") {\\n        linkName = \\\"page view\\\";\\n        additionalDataPayload.sotVars = {\\n          sotSubType: sotSubType,\\n          sotSubCategory: sotSubCategory,\\n          sotV01: pageTypeDetail,\\n          sotV02: pageWorld,\\n          sotV88: \\\"user profile my account password update\\\",\\n        };\\n      }\\n\\n      if (isChatPageView \\u0026\\u0026 linkName.indexOf(\\\"chat now cta:start session\\\") != -1) {\\n        linkName = \\\"page view\\\";\\n        additionalDataPayload.sotVars = {\\n          sotSubType: \\\"chat\\\",\\n          sotV01: \\\"home chat\\\",\\n        };\\n      }\\n\\n      if (linkName === \\\"jumplink:ratings and reviews\\\") {\\n        linkName = \\\"See All Reviews\\\";\\n      }\\n\\n      if (linkName === \\\"questions\\u0026answers:show more\\\") {\\n        linkName = \\\"questions and answers:show more\\\";\\n      }\\n\\n      if (linkName === \\\"product:custom set:select\\\") {\\n        linkName = \\\"Custom Set Add To Set\\\";\\n        additionalDataPayload.sotVars = {\\n          sotV04: getEventDetail(\\\"data.sku.skuId\\\"),\\n        };\\n      } else if (linkName === \\\"product:custom set:remove\\\") {\\n        linkName = \\\"Custom Set Remove From Set\\\";\\n        additionalDataPayload.sotVars = {\\n          sotV04: getEventDetail(\\\"data.sku.skuId\\\"),\\n        };\\n      } else if (linkName === \\\"view as list\\\") {\\n        linkName = \\\"Custom Set Items View More\\\";\\n        additionalDataPayload.sotVars = {\\n          sotV15: getEventAttribute(\\\"eventInfo.attributes.pageDetail\\\"),\\n        };\\n      } else if (linkName === \\\"product_learn more_related photos\\\") {\\n        linkName = \\\"page view\\\";\\n        additionalDataPayload.sotVars = {\\n          sotSubType: \\\"beauty board\\\",\\n          sotV01: \\\"photo detail\\\",\\n          sotV15: getEventAttribute(\\\"eventInfo.attributes.pageDetail\\\"),\\n          sotV18: getEventAttribute(\\\"eventInfo.attributes.photoId\\\"),\\n          sotV88: \\\"product learn more related photos\\\",\\n        };\\n      } else if (linkName === \\\"basket:redeem rewards:top\\\") {\\n        linkName = \\\"page view\\\";\\n        additionalDataPayload.sotVars = {\\n          sotSubType: sotSubType,\\n          sotSubCategory: sotSubCategory,\\n          sotV01: \\\"rewards bazaar\\\",\\n          sotV02: pageWorld,\\n          sotV88: \\\"basket rewards bazaar click\\\",\\n        };\\n      } else if (linkName === \\\"Shipping Option\\\" || linkName === \\\"same-day delivery radio button click\\\") {\\n        linkName = \\\"product fulfilment option selected\\\";\\n        const eventData = getEventDetail(\\\"data\\\");\\n        const { sku, shippingMethod, preferredStoreId, customerZipCode, stockAvailability } = eventData;\\n        additionalDataPayload.sotVars = {\\n          sotV04: sku?.skuId || \\\"\\\",\\n          sotV05: 1,\\n          sotV06: skuPrice || \\\"\\\",\\n          sotV07: skuBrand || \\\"\\\",\\n          sotV15: getProductIdforSotV15(eventProductId, eventPageDetail),\\n          sotV63: shippingMethod || \\\"\\\",\\n          sotV193: preferredStoreId || \\\"\\\",\\n          sotV187: customerZipCode || \\\"\\\",\\n          sotV192: sotSubCategory,\\n          sotV199: stockAvailability || \\\"\\\",\\n          sotV236: getLowInStockStatus(stockAvailability),\\n        };        \\n      } else if (linkName === \\\"bopis store selected\\\") {\\n        const eventData = getEventDetail(\\\"data\\\");\\n        const { sku, selectedStore, preferredStore } = eventData;\\n        additionalDataPayload.sotVars = {\\n          sotV04:  sku?.skuId || \\\"\\\",\\n          sotV193: selectedStore?.storeId || \\\"\\\",\\n          sotV195: preferredStore?.storeId || \\\"\\\",\\n          sotV190: selectedStore?.availabilityStatus === \\\"In Stock\\\" ? \\\"Yes\\\" : \\\"No\\\",\\n          sotV196: preferredStore?.availabilityStatus === \\\"In Stock\\\" ? \\\"Yes\\\" : \\\"No\\\",\\n        };\\n      } else if (linkName \\u0026\\u0026 linkName.indexOf(\\\"updated:bp privacy settings\\\") !== -1) {\\n        linkName = \\\"profile bi traits private\\\";\\n      } else if (linkName \\u0026\\u0026 productNotifications.includes(linkName)) {\\n        const eventData = getEventDetail(\\\"data\\\") || {};\\n        const {\\n          sku: { skuId = \\\"\\\", variationType = \\\"\\\", variationValue = \\\"\\\" } = {},\\n          productId = \\\"\\\",\\n          productCategory: { displayName = \\\"\\\" } = {},\\n          quantity = \\\"1\\\",\\n          price = \\\"\\\",\\n          notificationType = \\\"\\\",\\n          brandName = \\\"\\\",\\n          productName = \\\"\\\",\\n          variationType: eventVariationType = \\\"\\\",\\n          variationValue: eventVariationValue = \\\"\\\",\\n          emailId = \\\"n/a\\\",\\n          mobileNumber = \\\"\\\"\\n        } = eventData;\\n\\n        const preferredStoreId = getPreferredStoreId() || \\\"\\\";\\n        const customerZipCode = getCustomerZipCode() || \\\"\\\";\\n        const isSDNEnabledForOSSCSS = Sephora?.configurationSettings?.isSDNEnabledForOSSCSS || false;\\n        const skuImageUrl = eventData?.sku?.skuImages?.imageUrl;\\n        const image = digitalData?.product?.[0]?.attributes.image;\\n        const productSkuImageUrl = skuImageUrl || constructProductSkuImageURL(image, skuId) || \\\"\\\";\\n\\n        additionalDataPayload.sotVars = {\\n          sotV04: skuId,\\n          sotV05: quantity,\\n          sotV06: price,\\n          sotV07: brandName,\\n          sotV15: productId,\\n          sotV187: customerZipCode,\\n          sotV192: displayName,\\n          sotV193: preferredStoreId,\\n          sotV213: productSkuImageUrl,\\n          sotV215: productName,\\n          sotV216: variationType || eventVariationType,\\n          sotV217: variationValue || eventVariationValue,\\n          sotV256: notificationType,\\n          sotV257: emailId,\\n          sotV258: convertMobileNumber(mobileNumber) || \\\"n/a\\\",\\n          sotV363: isSDNEnabledForOSSCSS\\n        };\\n\\n      } else if (linkName === \\\"same-day unlimited:zip code unavailable\\\") {\\n        additionalDataPayload.sotVars.sotV187 = getEventDetail(\\\"data.customerZipCode\\\");\\n      } else if (linkName === \\\"basket:select samples:top\\\") {\\n        linkName = \\\"page view\\\";\\n        additionalDataPayload.sotVars = {\\n          sotSubType: sotSubType,\\n          sotSubCategory: sotSubCategory,\\n          sotV01: pageTypeDetail,\\n          sotV02: pageWorld,\\n        };\\n      }\\n\\n      if (linkName \\u0026\\u0026 linkName.indexOf(\\\"productfinder:start-quiz\\\") \\u003e= 0) {\\n        linkName = \\\"productfinder start quiz\\\";\\n        let pageName = getEventDetail(\\\"data.pageName\\\");\\n        let surveyName = pageName ? pageName.split(\\\":\\\")[2] || \\\"\\\" : \\\"\\\";\\n        additionalDataPayload.sotVars = {\\n          sotV168: surveyName,\\n        };\\n      }\\n\\n      if (autoReplenishEvents.includes(linkName)) {\\n        const {\\n          skuId = \\\"\\\",\\n          price = \\\"\\\",\\n          quantity = \\\"\\\",\\n          replenishmentFreqNum = \\\"\\\",\\n          replenishmentFreqType = \\\"\\\",\\n          status = \\\"\\\"\\n        } = getEventDetail(\\\"data\\\") || {};\\n\\n        additionalDataPayload.sotVars = {\\n          sotV04: skuId,\\n          sotV06: price,\\n          sotV05: quantity,\\n          sotV229: replenishmentFreqNum,\\n          sotV230: replenishmentFreqType,\\n          sotV231: status,\\n        };\\n      }\\n\\n      if (getEventAttribute(\\\"eventInfo.attributes.pageType\\\") === \\\"same-day unlimited\\\") {\\n        if (eventPageDetail === \\\"cancel trial confirmation\\\") {\\n          linkName = \\\"same day unlimited cancel trial confirmation\\\";\\n        } else if (eventPageDetail === \\\"cancel subscription confirmation\\\") {\\n          linkName = \\\"same day unlimited cancel subscription confirmation\\\";\\n        }\\n      }\\n\\n      //SA-831\\n      if (getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.linkName\\\") === \\\"replacement order submit for review click\\\") {\\n        linkName = \\\"replacement order submit for review click\\\";\\n        additionalDataPayload.sotVars = {\\n          sotV10: getEventDetail(\\\"data.originalOrderID\\\") || \\\"\\\",\\n          sotV251: getEventDetail(\\\"data.replacementOrderID\\\") || \\\"\\\",\\n        };\\n      }\\n\\n      //SA-1211, SA-1212, SA-1213\\n      if (getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.actionInfo\\\") \\u0026\\u0026 beautyPreferenceMileStone.includes(getEventDetail(\\\"data.actionInfo\\\"))) {\\n        let sotV88 = getEventDetail(\\\"data.previousPageName\\\") ? getEventDetail(\\\"data.previousPageName\\\") : \\\"\\\";\\n        linkName = getEventDetail(\\\"data.actionInfo\\\");\\n        additionalDataPayload.sotVars = {\\n          sotV88: sotV88,\\n        };\\n      }\\n\\n      //XSEL-4261\\n      if (\\n        getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.actionInfo\\\") \\u0026\\u0026 beautyOffersPromos.includes(getEventDetail(\\\"data.actionInfo\\\"))) {\\n        let { promoId, totalbasketCount, promoDisplayName } = getEventDetail(\\\"data\\\");\\n        additionalDataPayload.sotVars = {\\n          sotV297: promoId || \\\"\\\",\\n          sotV298: promoDisplayName || \\\"\\\",\\n          sotV289: totalbasketCount || 0,\\n        };\\n      }\\n      \\n      //SA-4038\\n      \\n      if(getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.sTagInfo\\\") \\u0026\\u0026 getEventDetail(\\\"data.sTagInfo.actionInfo\\\") \\u0026\\u0026 birthdayGiftMessage.includes(getEventDetail(\\\"data.sTagInfo.actionInfo\\\"))) {\\n        let { sid = \\\"\\\" } = getEventDetail(\\\"data.sTagInfo.giftMessagePayload\\\");\\n        linkName = getEventDetail(\\\"data.sTagInfo.actionInfo\\\");\\n        additionalDataPayload.sotVars = {\\n          sotV16: linkName,\\n          sotV310: sid || \\\"\\\",\\n          sotV410: getEventDetail(\\\"data.sTagInfo.currentLanguage\\\") || \\\"\\\"\\n        };\\n      }\\n      \\n      //SA-4041\\n      \\n       if(getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.sTagInfo\\\") \\u0026\\u0026 getEventDetail(\\\"data.sTagInfo.actionInfo\\\") \\u0026\\u0026 getEventDetail(\\\"data.sTagInfo.actionInfo\\\") === \\\"checkout shipping method update\\\") {\\n         let {shippingMethodId = \\\"\\\", shippingMethodType = \\\"\\\"} = getEventDetail(\\\"data.sTagInfo\\\");\\n         linkName = getEventDetail(\\\"data.sTagInfo.linkName\\\");\\n         additionalDataPayload.sotVars = {\\n          sotV63: shippingMethodType,\\n          sotV411: shippingMethodId\\n        };\\n      }\\n      \\n      //SA-4287 \\n      if(getEventDetail(\\\"data\\\") \\u0026\\u0026 getEventDetail(\\\"data.linkName\\\") \\u0026\\u0026 sharableListEvents.includes(getEventDetail(\\\"data.linkName\\\"))) {\\n         const {shoppingListId = \\\"\\\", shoppingListName = \\\"\\\", shoppingListSkuIds = [], isDefault = null, skuIdString = \\\"\\\", shoppingListItemsCount= null, listsCount = null} = getEventDetail(\\\"data\\\");\\n         additionalDataPayload.sotVars = {\\n          sotV04: shoppingListSkuIds?.join(\\\",\\\") || \\\"\\\",\\n          sotV05: shoppingListItemsCount,\\n          sotV259: skuIdString,\\n          sotV414: shoppingListName,\\n          sotV415: shoppingListId,\\n          sotV418: listsCount,\\n          sotV419: isDefault\\n        };\\n      }\\n      \\n\\n      var formattedSotType = formatSotType(linkName);\\n      if (formattedSotType === \\\"page view\\\" || formattedSotType === \\\"video popup\\\") {\\n        dataToSend.sotVars.sotV277 = ipAddress;\\n      }\\n\\n      let finalAllowedPayload = mergeSotVars(dataToSend, additionalDataPayload);\\n      let callNewEvtApi = false;\\n      let callNewEvtApiEvents = rmnEvents.concat(\\n        rmnImpressionEvents,\\n        rmnBannerEvents,\\n        set14OnwardsEvents,\\n        rmnCarouselEvents,\\n        askQuesAnsEvents,\\n        autoReplenishEvents,\\n        bbqPromo,\\n        beautyPreferenceMileStone,\\n        beautyOffersPromos,\\n        birthdayGiftMessage,\\n        sharableListEvents\\n      );\\n      if (callNewEvtApiEvents.indexOf(linkName) \\u003e -1) {\\n        callNewEvtApi = true;\\n      }\\n\\n      //SA-758\\n      if (bbqPromo.indexOf(linkName) !== -1) {\\n        linkName = linkName.toLowerCase();\\n        bbqEnabled = true;\\n      }\\n\\n      const isValidLinkName = getValidLinkName(linkName);\\n      if (isValidLinkName) {\\n        if (\\n          allowedLinkActionInfo.indexOf(linkName) != -1 ||\\n          isBasketSwitch ||\\n          isSwatchClick ||\\n          isLoginError ||\\n          isDeviceExistError ||\\n          isReviewNullSearch ||\\n          askQuesAns ||\\n          bbqEnabled\\n        ) {\\n          (window.sephoraOneTag_cmds = window.sephoraOneTag_cmds || []).push([\\n            \\\"trackEvent\\\",\\n            formattedSotType,\\n            finalAllowedPayload,\\n            null,\\n            callNewEvtApi,\\n          ]);\\n        }\\n\\n        //SA-1569\\n        //false - for calling evtTopic Call\\n        //true - for stockEvtTopic Call\\n        if (productNotifications.includes(linkName)) {\\n          (window.sephoraOneTag_cmds = window.sephoraOneTag_cmds || []).push([\\n            \\\"trackEvent\\\",\\n            formatSotType(linkName),\\n            finalAllowedPayload,\\n            null,\\n            false,\\n            true,\\n          ]);\\n        }\\n      }\\n    }\\n  } catch (error) {\\n    console.log(\\\"Failed in SOT - Link Page Tracking Tag\\\", error);\\n  }\\n})();\\n\",\"language\":\"javascript\"}"
    },
    "relationships": {
        "updated_with_extension_package": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0/updated_with_extension_package"
            },
            "data": {
                "id": "EP1fdd2a6ec2ae468fb1d2cac08df65f83",
                "type": "extension_packages"
            }
        },
        "updated_with_extension": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0/updated_with_extension"
            },
            "data": {
                "id": "EX35ce3802460d499b9f4c856d69a764b4",
                "type": "extensions"
            }
        },
        "extension": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0/extension"
            },
            "data": {
                "id": "EX881e591abc3d4b29b9681e2a4d337f74",
                "type": "extensions"
            }
        },
        "notes": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0/notes"
            }
        },
        "origin": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0/origin"
            },
            "data": {
                "id": "RC24e00d77a7584d32958094290212f9f0",
                "type": "rule_components"
            }
        },
        "property": {
            "links": {
                "related": "https://reactor.adobe.io/properties/PR28bc45fcba184e70b64b2f0cf7fe70f8"
            },
            "data": {
                "id": "PR28bc45fcba184e70b64b2f0cf7fe70f8",
                "type": "properties"
            }
        },
        "rules": {
            "links": {
                "related": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0/rules"
            }
        }
    },
    "links": {
        "extension": "https://reactor.adobe.io/extensions/EX881e591abc3d4b29b9681e2a4d337f74",
        "origin": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0",
        "rules": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0/rules",
        "self": "https://reactor.adobe.io/rule_components/RC24e00d77a7584d32958094290212f9f0"
    },
    "meta": {
        "latest_revision_number": 395
    }
}
